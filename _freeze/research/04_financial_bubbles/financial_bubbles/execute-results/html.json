{
  "hash": "09103ede5359f3ba286c51c0dae70221",
  "result": {
    "markdown": "---\ntitle: \"★Assessing Financial Bubbles\"\nauthor: \"Max Sands\"\ndate: \"2023-03-06\"\nimage: preview_image.png\ntitle-block-banner: preview_image.png\ndescription: \"Read Time: 10-15 mins\"\ncategories: [Equities, ★]\neditor_options: \n  chunk_output_type: console\nwarning: false\nmessage: false\n---\n\n\n\n\n## A Framework for Identifying Bubbles\n\nFinancial markets have experienced several notable financial bubbles in recent history. The Dot-Com bubble in 2001, the Great Financial Crisis in 2008, and the Tech bubble in 2022 are three examples. In each case, the period leading up to, during, and after the bubble's collapse brought varying degrees of market volatility and returns. Investors who exited before the crash were able to achieve impressive returns, while those who remained in the market experienced significant losses. As such, it is valuable for investors to be able to identify where financial bubbles are forming and their stage of development to avoid potential losses.\n\nIn his book [*Principles for Navigating Big Debt Crises*](https://www.bridgewater.com/big-debt-crises/principles-for-navigating-big-debt-crises-by-ray-dalio.pdf), Ray Dalio posits that markets are cyclical and that financial bubbles form for the same underlying reasons; he outlines the following rough framework for identifying financial bubbles with the associated message:\n\n![](financial_framework.png){fig-align=\"center\"}\n\n> *At this point I want to emphasize that it is a mistake to think that any one metric can serve as an indicator of an impending debt crisis. The ratio of debt to income for the economy as a whole, or even debt service payments to income for the economy as a whole, which is better, are useful but ultimately inadequate measures. To anticipate a debt crisis well, one has to look at the specific debt-service abilities of the individual entities, which are lost in these averages. More specifically, a high level of debt or debt service to income is less problematic if the average is well distributed across the economy than if it is concentrated --- especially if it is concentrated in key entities.*\n>\n> *- Ray Dalio*\n\nWhile the above framework is tailored for large-scale economic bubbles that drastically affected national economies, we will extend, adapt, and apply this framework to create a `Grand Financial Bubble Metric` and identify financial bubbles within various sectors of the U.S. economy and markets.\n\n<hr>\n\n## Methods for Quantifying the Framework\n\nThe following table outlines certain figures that can help us measure each component of Dalio's Rubric:\n\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Framework Component                                       | Ways to Quantify                                                                                                                                                                                                                                                                                                                                                              |\n+===========================================================+===============================================================================================================================================================================================================================================================================================================================================================================+\n| *Are prices high relative to traditional measures?*       | 1.  Price-to-Earnings (P/E) Ratio: The P/E ratio is a popular metric for valuing stocks that compares the stock price to the earnings per share. A high P/E ratio suggests that the stock is overvalued relative to its earnings.                                                                                                                                             |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 2.  Price-to-Book (P/B) Ratio: The P/B ratio compares a company's stock price to its book value (i.e., the value of its assets minus its liabilities). A high P/B ratio may suggest that the stock is overvalued relative to its book value.                                                                                                                                  |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 3.  Price-to-Sales (P/S) Ratio: The P/S ratio compares a company's stock price to its sales per share. A high P/S ratio may suggest that the stock is overvalued relative to its sales.                                                                                                                                                                                       |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Are prices discounting future rapid price appreciation?* | 1.  Options Market: The options market can provide clues as to whether investors are expecting rapid price appreciation in the future. For example, a high call option volume or a low put option volume may suggest that investors are optimistic about future price movements.                                                                                              |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Are purchases being financed by high leverage?*          | 1.  Debt-to-Equity Ratio: The debt-to-equity ratio is a common measure of a company's leverage, and it compares the amount of debt the company has to its equity. A high debt-to-equity ratio may suggest that the company is financing its purchases with a significant amount of debt.                                                                                      |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 2.  Debt-to-GDP: A measure of debt relative to the income of an entire economy.                                                                                                                                                                                                                                                                                               |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Are buyers/companies making forward purchases?*          | 1.  Inventory Levels: If a company's inventory levels are high, it may suggest that the company is making forward purchases to secure goods at current prices for future use or resale.                                                                                                                                                                                       |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 2.  Purchase Orders: Publicly traded companies are required to disclose purchase orders and contracts with suppliers in their financial statements. By analyzing these disclosures, investors can gain insight into the company's purchasing activities and determine if they are making forward purchases.                                                                   |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 3.  Capital Expenditures: Companies may make forward purchases as part of their capital expenditures, which are investments in long-term assets. For example, a manufacturing company may purchase machinery and equipment in advance to increase production capacity.                                                                                                        |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Have new participants entered the market?*               | 1.  IPO data from SEC Regulatory Filings: Publicly traded companies are required to file regulatory reports to the SEC when going public.                                                                                                                                                                                                                                     |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 2.  Composition of Indices: The composition of Indices like the Russell 3000 across different sectors can give clues as to whether new participants have entered a specific market segment.                                                                                                                                                                                   |\n|                                                           |                                                                                                                                                                                                                                                                                                                                                                               |\n|                                                           | 3.  Number of Employees: Tracking the proportion of employees in a certain sector relative to the entire workforce may provide clues to whether new participants have entered a specific market.                                                                                                                                                                              |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Is there broad bullish sentiment?*                       | 1.  News Sentiment...                                                                                                                                                                                                                                                                                                                                                         |\n|                                                           | 2.  Interview Market Leaders...                                                                                                                                                                                                                                                                                                                                               |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| *Does tightening risk popping the bubble?*                | 1.  Interest Coverage Ratio: The interest coverage ratio measures a company's ability to pay its interest expenses on its debt. If a company's interest coverage ratio is low, it may suggest that the company is struggling to make its interest payments. Assessing hypothetical interest coverage ratios if interest rates increase will likely help answer this question. |\n+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nGoing forward, we will only consider the following framework components, as I believe they best encapsulate the underpinnings of the framework and are simultaneously easy to quantify:\n\n1.  Are prices high relative to traditional measures?\n\n2.  Are purchases being financed w/ high leverage?\n\n3.  Have new participants entered the market?\n\n4.  Does tightening risk popping the bubble?\n\n<hr>\n\n## The Data\n\nIn order to do this, I have collected:\n\n-   Key figures from the Income Statements, Balance Sheets, and Cash Flow Statements of all the companies in the Russell 3000 Index since 1996, including the sector classification of each company\n\n-   Global IPO data since 1993\n\n-   Economic Data (GDP, Labor Force, Federal Funds Rate, etc.)\n\nHere is a glimpse of each data-set:\n\n::: panel-tabset\n### Russell 3000 Data\n\n::: panel-tabset\n#### Income Statement\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>%\n    head(n=10) %>%\n    select(year:name, income_statement) %>%\n    unnest(income_statement) %>%\n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title()) %>%\n    mutate(across(.cols = c(-Year, -Ticker, -Name), .fns = ~scales::dollar(.x, scale = 1e-6, suffix = \"M\", largest_with_cents = 1, style_negative = \"parens\")))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Year|Ticker |Name                             |Revenue   |Cogs      |Gross Profit |Interest Expense |Interest Income |Operating Income |Net Income |\n|----:|:------|:--------------------------------|:---------|:---------|:------------|:----------------|:---------------|:----------------|:----------|\n| 2022|A      |Agilent Technologies Inc         |$6,848M   |$3,126M   |$3,722M      |$84M             |$9M             |$1,618M          |$1,254M    |\n| 2022|AA     |Alcoa Corp                       |$12,152M  |$9,153M   |$2,999M      |$195M            |$0M             |$949M            |$429M      |\n| 2022|AADI   |Aadi Bioscience Inc              |$1M       |NA        |NA           |$1M              |$0M             |($111M)          |($110M)    |\n| 2022|AAL    |American Airlines Group Inc      |$29,882M  |NA        |NA           |$1,800M          |$18M            |($1,059M)        |($1,993M)  |\n| 2022|AAN    |Aaron's Co Inc/The               |$1,846M   |$686M     |$1,159M      |$1M              |$0M             |$146M            |$110M      |\n| 2022|AAON   |AAON Inc                         |$535M     |$397M     |$138M        |$0M              |$0M             |$69M             |$59M       |\n| 2022|AAP    |Advance Auto Parts Inc           |$10,998M  |$6,069M   |$4,929M      |$38M             |$0M             |$839M            |$616M      |\n| 2022|AAPL   |Apple Inc                        |$394,328M |$223,546M |$170,782M    |$2,931M          |$2,825M         |$119,437M        |$99,803M   |\n| 2022|AAT    |American Assets Trust Inc        |$376M     |NA        |NA           |$59M             |$0M             |$100M            |$37M       |\n| 2022|AAWW   |Atlas Air Worldwide Holdings Inc |$4,031M   |$2,728M   |$1,303M      |$99M             |$1M             |$711M            |$493M      |\n\n</div>\n:::\n:::\n\n\n#### Balance Sheet\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    head(n=10) %>% \n    select(year:name, balance_sheet) %>% \n    unnest(balance_sheet) %>% \n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title()) %>% \n    mutate(across(.cols = c(-Year, -Ticker, -Name), .fns = ~scales::dollar(.x, scale = 1e-6, suffix = \"M\", largest_with_cents = 1, style_negative = \"parens\"))) \n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Year|Ticker |Name                             |Current Assets |Non Current Assets |Total Assets |Inventory |Current Liabilities |Non Current Liabilities |Total Liabilities |St Debt  |Lt Debt   |Total Debt |Total Equity |\n|----:|:------|:--------------------------------|:--------------|:------------------|:------------|:---------|:-------------------|:-----------------------|:-----------------|:--------|:---------|:----------|:------------|\n| 2022|A      |Agilent Technologies Inc         |$3,778M        |$6,754M            |$10,532M     |$1,038M   |$1,861M             |$3,366M                 |$5,227M           |$87M     |$2,834M   |$2,921M    |$5,305M      |\n| 2022|AA     |Alcoa Corp                       |$5,026M        |$9,999M            |$15,025M     |$1,956M   |$3,223M             |$5,518M                 |$8,741M           |$36M     |$1,790M   |$1,826M    |$6,284M      |\n| 2022|AADI   |Aadi Bioscience Inc              |$151M          |$7M                |$158M        |$0M       |$15M                |$6M                     |$22M              |$0M      |$0M       |$1M        |$136M        |\n| 2022|AAL    |American Airlines Group Inc      |$17,336M       |$49,131M           |$66,467M     |$1,795M   |$19,006M            |$54,801M                |$73,807M          |$3,996M  |$42,181M  |$46,177M   |($7,340M)    |\n| 2022|AAN    |Aaron's Co Inc/The               |$824M          |$617M              |$1,441M      |$772M     |$245M               |$478M                   |$723M             |$95M     |$320M     |$415M      |$718M        |\n| 2022|AAON   |AAON Inc                         |$218M          |$432M              |$650M        |$130M     |$87M                |$97M                    |$184M             |$0M      |$40M      |$40M       |$466M        |\n| 2022|AAP    |Advance Auto Parts Inc           |$6,275M        |$5,919M            |$12,194M     |$4,659M   |$5,180M             |$3,886M                 |$9,066M           |$465M    |$3,372M   |$3,837M    |$3,128M      |\n| 2022|AAPL   |Apple Inc                        |$135,405M      |$217,350M          |$352,755M    |$4,946M   |$153,982M           |$148,101M               |$302,083M         |$22,773M |$109,707M |$132,480M  |$50,672M     |\n| 2022|AAT    |American Assets Trust Inc        |NA             |NA                 |$3,018M      |NA        |NA                  |NA                      |NA                |$1,538M  |$142M     |$1,680M    |$1,210M      |\n| 2022|AAWW   |Atlas Air Worldwide Holdings Inc |$1,326M        |$5,117M            |$6,443M      |$0M       |$1,420M             |$2,214M                 |$3,634M           |$695M    |$1,821M   |$2,516M    |$2,809M      |\n\n</div>\n:::\n:::\n\n\n#### Cash Flow Statement\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    head(n=10) %>% \n    select(year:name, cash_flow_statement) %>% \n    unnest(cash_flow_statement) %>% \n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title()) %>% \n    mutate(across(.cols = c(-Year, -Ticker, -Name), .fns = ~scales::dollar(.x, scale = 1e-6, suffix = \"M\", largest_with_cents = 1, style_negative = \"parens\")))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Year|Ticker |Name                             |Free Cash Flow |Capex      |\n|----:|:------|:--------------------------------|:--------------|:----------|\n| 2022|A      |Agilent Technologies Inc         |$1,021M        |($291M)    |\n| 2022|AA     |Alcoa Corp                       |$530M          |($390M)    |\n| 2022|AADI   |Aadi Bioscience Inc              |($22M)         |$0M        |\n| 2022|AAL    |American Airlines Group Inc      |$496M          |($208M)    |\n| 2022|AAN    |Aaron's Co Inc/The               |$43M           |($93M)     |\n| 2022|AAON   |AAON Inc                         |$6M            |($55M)     |\n| 2022|AAP    |Advance Auto Parts Inc           |$823M          |($290M)    |\n| 2022|AAPL   |Apple Inc                        |$111,443M      |($10,708M) |\n| 2022|AAT    |American Assets Trust Inc        |$64M           |($105M)    |\n| 2022|AAWW   |Atlas Air Worldwide Holdings Inc |$833M          |($90M)     |\n\n</div>\n:::\n:::\n\n\n#### Miscellaneous\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    head(n=10) %>% \n    select(year:name, misc) %>% \n    unnest(misc) %>% \n    mutate(across(.cols = c(market_cap), .fns = ~scales::dollar(.x, scale = 1e-6, suffix = \"M\", largest_with_cents = 1, style_negative = \"parens\"))) %>% \n    mutate(price = scales::dollar(price)) %>%\n    mutate(across(.cols = c(contains(\"num\")), .fns = ~scales::number(.x, big.mark = \",\", scale_cut = scales::cut_long_scale()))) %>% \n    mutate(across(.cols = c(contains(\"price_to\"), inventory_turnover), .fns = ~scales::number(round(.x, digits = 1), suffix = \"x\"))) %>% \n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title())\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Year|Ticker |Name                             |Num Employees |Price   |Market Cap  |Price To Sales |Price To Book |Price To Earnings |Num Shares |Inventory Turnover |\n|----:|:------|:--------------------------------|:-------------|:-------|:-----------|:--------------|:-------------|:-----------------|:----------|:------------------|\n| 2022|A      |Agilent Technologies Inc         |18.1K         |$150.04 |$40,813M    |6.0x           |7.7x          |29.4x             |295.00M    |3.3x               |\n| 2022|AA     |Alcoa Corp                       |12.2K         |$44.58  |$5,956M     |0.5x           |1.1x          |4.2x              |176.94M    |5.5x               |\n| 2022|AADI   |Aadi Bioscience Inc              |12            |$12.31  |$345M       |27.1x          |2.0x          |NA                |24.40M     |NA                 |\n| 2022|AAL    |American Airlines Group Inc      |123.4K        |$12.74  |$7,824M     |0.2x           |NA            |NA                |649.86M    |NA                 |\n| 2022|AAN    |Aaron's Co Inc/The               |9.2K          |$11.85  |$299M       |0.1x           |0.4x          |5.8x              |30.78M     |0.9x               |\n| 2022|AAON   |AAON Inc                         |2.9K          |$74.83  |$2,867M     |3.7x           |5.5x          |40.9x             |53.21M     |3.7x               |\n| 2022|AAP    |Advance Auto Parts Inc           |41.0K         |$151.54 |$9,630M     |0.9x           |3.5x          |14.6x             |59.70M     |1.3x               |\n| 2022|AAPL   |Apple Inc                        |164.0K        |$125.07 |$2,398,369M |6.2x           |47.3x         |24.6x             |15,943.43M |38.8x              |\n| 2022|AAT    |American Assets Trust Inc        |208           |$26.51  |$1,557M     |3.7x           |1.3x          |36.2x             |60.53M     |NA                 |\n| 2022|AAWW   |Atlas Air Worldwide Holdings Inc |4.1K          |$101.25 |$2,711M     |0.6x           |0.9x          |7.2x              |28.36M     |NA                 |\n\n</div>\n:::\n:::\n\n\n#### Classification\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    head(n=10) %>% \n    select(year:name, classification) %>% \n    unnest(classification) %>% \n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title())\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Year|Ticker |Name                             |Classification 1       |Classification 2                |Classification 3            |Classification 4             |Classification 5                |Classification 6                |Classification 7                |Classification 8                |\n|----:|:------|:--------------------------------|:----------------------|:-------------------------------|:---------------------------|:----------------------------|:-------------------------------|:-------------------------------|:-------------------------------|:-------------------------------|\n| 2022|A      |Agilent Technologies Inc         |Health Care            |Health Care                     |Medical Equipment & Devices |Life Science & Diagnostics   |Life Science Equipment          |Life Science Equipment          |Life Science Equipment          |Life Science Equipment          |\n| 2022|AA     |Alcoa Corp                       |Materials              |Materials                       |Metals & Mining             |Base Metals                  |Aluminum                        |Aluminum                        |Aluminum                        |Aluminum                        |\n| 2022|AADI   |Aadi Bioscience Inc              |Health Care            |Health Care                     |Biotech & Pharma            |Biotech                      |Biotech                         |Biotech                         |Biotech                         |Biotech                         |\n| 2022|AAL    |American Airlines Group Inc      |Industrials            |Industrial Services             |Transportation & Logistics  |Airlines                     |Full Service Airline            |Full Service Airline            |Full Service Airline            |Full Service Airline            |\n| 2022|AAN    |Aaron's Co Inc/The               |Consumer Discretionary |Consumer Discretionary Services |Consumer Services           |Consumer Goods Rental        |Consumer Goods Rental           |Consumer Goods Rental           |Consumer Goods Rental           |Consumer Goods Rental           |\n| 2022|AAON   |AAON Inc                         |Industrials            |Industrial Products             |Electrical Equipment        |Comml & Res Bldg Equip & Sys |HVAC Building Products          |A/C Heating & Fridge Equip      |A/C Heating & Fridge Equip      |A/C Heating & Fridge Equip      |\n| 2022|AAP    |Advance Auto Parts Inc           |Consumer Discretionary |Retail & Whsle - Discretionary  |Retail - Discretionary      |Automotive Retailers         |Auto Parts & Accessories Stores |Auto Parts & Accessories Stores |Auto Parts & Accessories Stores |Auto Parts & Accessories Stores |\n| 2022|AAPL   |Apple Inc                        |Technology             |Tech Hardware & Semiconductors  |Technology Hardware         |Communications Equipment     |Mobile Phones                   |Mobile Phones                   |Mobile Phones                   |Mobile Phones                   |\n| 2022|AAT    |American Assets Trust Inc        |Real Estate            |Real Estate                     |REIT                        |Multi Asset Class REIT       |Multi Asset Class REIT          |Multi Asset Class REIT          |Multi Asset Class REIT          |Multi Asset Class REIT          |\n| 2022|AAWW   |Atlas Air Worldwide Holdings Inc |Industrials            |Industrial Services             |Transportation & Logistics  |Air Freight                  |Air Freight                     |Air Freight                     |Air Freight                     |Air Freight                     |\n\n</div>\n:::\n:::\n\n:::\n\n### IPO Data\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>% \n    head(n=10) %>% \n    select(announced_date, ticker, issuer_name, offer_size, classification_1) %>% \n    rename(size = offer_size) %>% \n    mutate(size = scales::dollar(size, suffix = \"M\")) %>% \n    set_names(names(.) %>% str_replace_all(\"_\", \" \") %>% str_to_title())\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Announced Date |Ticker          |Issuer Name                    |Size             |Classification 1       |\n|:--------------|:---------------|:------------------------------|:----------------|:----------------------|\n|2021-10-01     |RIVN US EQUITY  |Rivian Automotive Inc          |$13,724,100,000M |Consumer Discretionary |\n|2021-10-04     |GFS US EQUITY   |GLOBALFOUNDRIES Inc            |$2,855,160,000M  |Technology             |\n|2021-07-01     |HOOD US EQUITY  |Robinhood Markets Inc          |$2,255,460,000M  |Financials             |\n|2021-06-24     |SPNGU US EQUITY |Spinning Eagle Acquisition Cor |$2,000,000,000M  |Financials             |\n|2021-08-27     |OLPX US EQUITY  |Olaplex Holdings Inc           |$1,779,850,000M  |Consumer Staples       |\n|2022-03-28     |CRBG US EQUITY  |Corebridge Financial Inc       |$1,680,000,000M  |Financials             |\n|2021-06-21     |RYAN US EQUITY  |Ryan Specialty Holdings Inc    |$1,538,220,000M  |Financials             |\n|2021-06-03     |S US EQUITY     |SentinelOne Inc                |$1,408,750,000M  |Technology             |\n|2021-11-04     |HCP US EQUITY   |HashiCorp Inc                  |$1,322,400,000M  |Technology             |\n|2021-10-15     |HTZ US EQUITY   |Hertz Global Holdings Inc      |$1,291,080,000M  |Consumer Discretionary |\n\n</div>\n:::\n:::\n\n:::\n\n<hr>\n\n## Quantifying the Framework\n\nIn the following, we will inspect each element of the framework with the data available to us:\n\n<hr>\n\n### 1) Prices are High Relative to Traditional Measures\n\nLet's take a look at the historical P/S, P/B, and P/E ratios of each sector. To do this, we will plot the median value of these ratios since 1995 for different sectors while also aggregating by company size according to the following schema:\n\n+-----------------+---------------------------------------------------------+\n| Small Cap       | Market Cap between 0th-40th Percentile for its Sector   |\n+-----------------+---------------------------------------------------------+\n| Mid Cap         | Market Cap between 40th-80th Percentile for its Sector  |\n+-----------------+---------------------------------------------------------+\n| Large Cap       | Market Cap between 80th-95th Percentile for its Sector  |\n+-----------------+---------------------------------------------------------+\n| Ultra-Large Cap | Market Cap between 95th-100th Percentile for its Sector |\n+-----------------+---------------------------------------------------------+\n\n::: panel-tabset\n#### Price-to-Sales\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    select(date:bucket, misc, classification) %>% \n    unnest(c(misc, classification)) %>%\n    group_by(date, classification_1, bucket) %>% \n    summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    ggplot(aes(date, price_to_sales, color = bucket)) +\n    geom_line() +\n    geom_hline(\n        data = . %>%\n            group_by(classification_1, bucket) %>%\n            summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>%\n            ungroup() %>%\n            filter(bucket %in% c(\"Large Cap\")),\n        mapping = aes(yintercept = price_to_sales),\n        color = palette_light()[1],\n        lty = 2\n    ) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    scale_y_continuous(labels = scales::label_number(suffix = \"x\")) +\n    scale_x_date(date_breaks = \"5 years\", labels = scales::label_date(format = \"'%y\")) +\n    labs(x = \"\", y = \"\", title = \"Median Price-to-Sales\", color = \"\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![Dashed line represents median of medians for *Large Cap* bucket](financial_bubbles_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n#### Price-to-Book\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    select(date:bucket, misc, classification) %>% \n    unnest(c(misc, classification)) %>%\n    group_by(date, classification_1, bucket) %>% \n    summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    ggplot(aes(date, price_to_book, color = bucket)) +\n    geom_line() +\n    geom_hline(\n        data = . %>%\n            group_by(classification_1, bucket) %>%\n            summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>%\n            ungroup() %>%\n            filter(bucket %in% c(\"Large Cap\")),\n        mapping = aes(yintercept = price_to_book),\n        color = palette_light()[1],\n        lty = 2\n    ) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    scale_y_continuous(labels = scales::label_number(suffix = \"x\")) +\n    scale_x_date(date_breaks = \"5 years\", labels = scales::label_date(format = \"'%y\")) +\n    labs(x = \"\", y = \"\", title = \"Median Price-to-Book\", color = \"\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![Dashed line represents median of medians for *Large Cap* bucket](financial_bubbles_files/figure-html/unnamed-chunk-9-1.png){width=1152}\n:::\n:::\n\n\n#### Price-to-Earnings\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    select(date:bucket, misc, classification) %>% \n    unnest(c(misc, classification)) %>%\n    group_by(date, classification_1, bucket) %>% \n    summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    ggplot(aes(date, price_to_earnings, color = bucket)) +\n    geom_line() +\n    geom_hline(\n        data = . %>%\n            group_by(classification_1, bucket) %>%\n            summarize(across(.cols = contains(\"price_to\"), .fns = ~median(.x, na.rm = T))) %>%\n            ungroup() %>%\n            filter(bucket %in% c(\"Large Cap\")),\n        mapping = aes(yintercept = price_to_earnings),\n        color = palette_light()[1],\n        lty = 2\n    ) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    scale_y_continuous(labels = scales::label_number(suffix = \"x\")) +\n    scale_x_date(date_breaks = \"5 years\", labels = scales::label_date(format = \"'%y\")) +\n    labs(x = \"\", y = \"\", title = \"Median Price-to-Earnings\", color = \"\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![Dashed line represents median of medians for *Large Cap* bucket](financial_bubbles_files/figure-html/unnamed-chunk-10-1.png){width=1152}\n:::\n:::\n\n:::\n\nThe above is overwhelming, but it does paint the general picture that financial bubbles have formed when prices are high relative to traditional measures. For instance, the Dot-Com Bubble of '00/'01 is seen most uniformly in the above with high price ratios across the board.\n\nHowever, let's try to represent the data in a more concise and standardized fashion.\n\n#### Creating a Price Metric\n\nLet's create a standard `Price Metric` by:\n\n1.  Calculating the distance of each of these ratios from a median line\n2.  Dividing this distance by the average absolute distance from the median line\n3.  Averaging the standardized distances for the P/S, P/B, & P/E ratios together to a create a single `Price Metric`\n\nBy doing this we will have a rough estimation of how elevated prices are for each of these sectors and market cap buckets.\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nprice_metric_tbl <- r3000_nested %>% \n    select(date:bucket, misc, classification) %>% \n    unnest(c(misc, classification)) %>%\n    select(date, ticker, name, bucket, classification_1, contains(\"price_to\")) %>% \n    group_by(date, classification_1, bucket) %>% \n    summarize(across(contains(\"price_to\"), ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    pivot_longer(contains(\"price_to\")) %>% \n    group_by(classification_1, bucket, name) %>% \n    mutate(med_value = median(value)) %>% \n    mutate(distance = value - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(standardized_distance = distance / avg_distance) %>% \n    ungroup() %>%\n    group_by(date, classification_1, bucket) %>% \n    summarize(price_metric = mean(standardized_distance, na.rm = T)) %>% \n    ungroup()\n\nprice_metric_tbl %>% \n    ggplot(aes(date, price_metric, color = bucket)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(date_breaks = \"5 years\", labels = scales::label_date(format = \"'%y\")) +\n    labs(x = \"\", y = \"\", title = \"Price Metric\", color = \"\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-11-1.png){width=1152}\n:::\n:::\n\n\n#### Creating a Price Growth Metric\n\nWhile the absolute level of prices in different markets are important, it is also likely that the amount by which they change, especially if that change occurs abruptly, is also important. Therefore, let's create a `Price Growth Metric` by simply calculating the year-over-year change of our `Price Metric`:\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nprice_metric_tbl %>% \n    group_by(classification_1, bucket) %>% \n    mutate(price_growth_metric = price_metric - lag(price_metric)) %>% \n    ungroup() %>% \n    ggplot(aes(date, price_growth_metric, color = bucket)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(date_breaks = \"5 years\", labels = scales::label_date(format = \"'%y\")) +\n    labs(x = \"\", y = \"\", title = \"Price Growth Metric\", color = \"\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-12-1.png){width=1152}\n:::\n:::\n\n\n##### Takeaways:\n\nFrom eye-balling the above charts we can conclude that the following sectors were highly priced relative to traditional measures:\n\n+------------------------+-----------------------------------+\n| Sector                 | Time Periods                      |\n+========================+===================================+\n| Communications         | '99 - '01, '20 - '22              |\n+------------------------+-----------------------------------+\n| Consumer Discretionary | '20 - '22                         |\n+------------------------+-----------------------------------+\n| Consumer Staples       | '97 - '02, '22                    |\n+------------------------+-----------------------------------+\n| Energy                 | '00, '17 - '18                    |\n+------------------------+-----------------------------------+\n| Financials             | '98 - '02, '18                    |\n+------------------------+-----------------------------------+\n| Health Care            | '98-'02, '20 - '22                |\n+------------------------+-----------------------------------+\n| Industrials            | '20 - '22                         |\n+------------------------+-----------------------------------+\n| Materials              | '20 - '22                         |\n+------------------------+-----------------------------------+\n| Real Estate            | '19 - '22                         |\n+------------------------+-----------------------------------+\n| Technology             | '99 - '02, '20 - '23              |\n+------------------------+-----------------------------------+\n| Utilities              | '01, '07, '18 - '23               |\n+------------------------+-----------------------------------+\n\nAs we continue through our framework, we will see if the same time periods resurface.\n\n#### Digging Deeper\n\nNow that we have time periods in which certain broad sectors were highly priced, we can repeat the above at a more granular level. This is important since large values can be washed away in averages when aggregating at broader hierarchical sector levels. For instance, we could have a high price metric of +3 for *Semiconductors* and a low metric of -3 for *Software*; if these were the only two sub-sectors in the *Technology* space, then the price metric for *Technology* would likely lie around 0. This scenario is much different from one wherein both *Semiconductors* and *Software* have price metrics of 0, which would also consequently yield a price metric of around 0 for *Technology*.\n\nIn the following, we consider only *Large Cap* and *Ultra-Large Cap* as there are fewer companies in each bucket when aggregating at a more granular sector level:\n\n::: panel-tabset\n##### Price Metric\n\n::: panel-tabset\n\n\n```{.r .cell-code}\nclassification_1_vec <- r3000_raw %>% distinct(classification_1) %>% pull()\n\nstart_tbl <- r3000_nested %>% \n    select(date, misc, classification) %>% \n    unnest(c(misc, classification)) %>% \n    select(date, market_cap, contains(\"price_to\"), classification_1, classification_3) %>% \n    filter(!is.na(market_cap)) %>% \n    group_by(date, classification_3) %>% \n    mutate(quantile = ntile(market_cap, n = 10)) %>% \n    ungroup() %>% \n    filter(quantile %in% 9:10)\n           \nplots <- list()\nfor (i in seq_along(classification_1_vec)){\n    \n    g <- start_tbl %>% \n    filter(classification_1 == classification_1_vec[i]) %>% \n    group_by(date, classification_3) %>% \n    summarize(across(contains(\"price_to\"), ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    pivot_longer(contains(\"price_to\")) %>% \n    group_by(classification_3, name) %>% \n    mutate(med_value = median(value, na.rm = T)) %>% \n    mutate(distance = value - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    group_by(date, classification_3) %>% \n    summarize(price_metric = mean(standardized_distance, na.rm = T)) %>% \n    ggplot(aes(date, price_metric)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    theme_tq(base_size = 24) +\n    scale_color_tq() +\n    facet_wrap(~classification_3, scales = \"free\", ncol = 2) +\n    labs(x=\"\", y = \"\", title = \"Price Metric\", color = \"\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n    \n    plots[[classification_1_vec[i]]] <- g\n    \n}\n\niwalk(plots, ~ {\n  cat('## ', .y, '\\n\\n')\n  \n  print(.x)\n  \n  cat('\\n\\n')\n  \n})\n```\n\n##  Health Care \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-1.png){width=1152}\n:::\n\n\n\n##  Materials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-2.png){width=1152}\n:::\n\n\n\n##  Industrials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-3.png){width=1152}\n:::\n\n\n\n##  Consumer Discretionary \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-4.png){width=1152}\n:::\n\n\n\n##  Technology \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-5.png){width=1152}\n:::\n\n\n\n##  Real Estate \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-6.png){width=1152}\n:::\n\n\n\n##  Financials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-7.png){width=1152}\n:::\n\n\n\n##  Communications \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-8.png){width=1152}\n:::\n\n\n\n##  Energy \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-9.png){width=1152}\n:::\n\n\n\n##  Consumer Staples \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-10.png){width=1152}\n:::\n\n\n\n##  Utilities \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-13-11.png){width=1152}\n:::\n\n:::\n\n##### Price Growth Metric\n\n::: panel-tabset\n\n\n```{.r .cell-code}\nplots <- list()\nfor (i in seq_along(classification_1_vec)){\n    \n    g <- start_tbl %>% \n    filter(classification_1 == classification_1_vec[i]) %>% \n    group_by(date, classification_3) %>% \n    summarize(across(contains(\"price_to\"), ~median(.x, na.rm = T))) %>% \n    ungroup() %>% \n    pivot_longer(contains(\"price_to\")) %>% \n    group_by(classification_3, name) %>% \n    mutate(med_value = median(value, na.rm = T)) %>% \n    mutate(distance = value - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    group_by(date, classification_3) %>% \n    summarize(price_metric = mean(standardized_distance, na.rm = T)) %>% \n    ungroup() %>% \n    group_by(classification_3) %>% \n    mutate(price_growth_metric = price_metric - lag(price_metric)) %>% \n    ungroup() %>% \n    drop_na() %>% \n    ggplot(aes(date, price_growth_metric)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    theme_tq(base_size = 24) +\n    scale_color_tq() +\n    facet_wrap(~classification_3, scales = \"free\", ncol = 2) +\n    labs(x=\"\", y = \"\", title = \"Price Growth Metric\", color = \"\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n    \n    plots[[classification_1_vec[i]]] <- g\n    \n}\n\niwalk(plots, ~ {\n  cat('## ', .y, '\\n\\n')\n  \n  print(.x)\n  \n  cat('\\n\\n')\n  \n})\n```\n\n##  Health Care \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-1.png){width=1152}\n:::\n\n\n\n##  Materials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-2.png){width=1152}\n:::\n\n\n\n##  Industrials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-3.png){width=1152}\n:::\n\n\n\n##  Consumer Discretionary \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-4.png){width=1152}\n:::\n\n\n\n##  Technology \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-5.png){width=1152}\n:::\n\n\n\n##  Real Estate \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-6.png){width=1152}\n:::\n\n\n\n##  Financials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-7.png){width=1152}\n:::\n\n\n\n##  Communications \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-8.png){width=1152}\n:::\n\n\n\n##  Energy \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-9.png){width=1152}\n:::\n\n\n\n##  Consumer Staples \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-10.png){width=1152}\n:::\n\n\n\n##  Utilities \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-14-11.png){width=1152}\n:::\n\n:::\n:::\n\n<hr>\n\n### 2) Purchases are Being Financed w/ High Leverage\n\nLet's take a look at the historical debt levels of each sector since 1995. Once again, we will aggregate by company size and plot the median value for different sectors. In this section we will consider two metrics to assess debt levels:\n\n$$\nMetric_1 =  \\frac{D_t}{E_t} = \\frac{LT\\ Debt_t + ST\\ Debt_t}{Equity_t}\n$$\n\n$$\nMetric_2 = \\frac{Avg\\ Debt_t}{GDP_t} = \\frac{(\\frac{\\sum{LT\\ Debt_t + ST\\ Debt_t}}{No.\\ of\\ Companies_t})}{GDP_t}\n$$\n\nThe first metric aims to represent leverage at the company level, whereas the second metric aims to represent the significance of that debt in relation to the size of the general economy.\n\nIn the second metric, we consider the *average* debt level as a ratio to GDP because the number of companies within each sector of the Russell 3000 varies each year. Therefore, simply calculating the sum for each year could overstate debt levels for years in which there are more companies than usual. Instead, we hope to measure this in isolation in the section *`3) New entrants are entering the market`*.\n\n::: panel-tabset\n#### Metric 1\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nr3000_nested %>% \n    select(date:bucket, -year, balance_sheet, classification) %>% \n    unnest(c(balance_sheet, classification)) %>% \n    mutate(d_e = (st_debt + lt_debt) / total_equity) %>% \n    select(date:bucket, classification_1, d_e) %>% \n    group_by(date, classification_1, bucket) %>% \n    summarize(d_e = median(d_e, na.rm = T)) %>% \n    ungroup() %>% \n    ggplot(aes(date, d_e, color = bucket)) +\n    geom_line() +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    labs(x=\"\", y = \"\", title = \"Median Debt-to-Equity\", color = \"\") +\n    scale_y_continuous(labels = scales::label_number(suffix = \"x\")) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-15-1.png){width=1152}\n:::\n:::\n\n\n#### Metric 2\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ngdp <- read_rds(here(\"raw_data\", \"Financial Bubbles\", \"gdp.rds\")) %>% \n    mutate(gdp = gdp * 1e9)\n\nr3000_nested %>%\n    select(date:bucket, -year, balance_sheet, classification) %>%\n    unnest(c(balance_sheet, classification)) %>%\n    select(date:bucket, classification_1, total_debt) %>%\n    filter(!is.na(total_debt)) %>%\n    group_by(date, classification_1, bucket) %>%\n    summarize(\n        sum_debt = sum(total_debt, na.rm = T),\n        count = n()\n    ) %>%\n    ungroup() %>%\n    left_join(gdp) %>%\n    mutate(avg_debt_to_gdp = ((sum_debt / count) / gdp)) %>%\n    ggplot(aes(date, avg_debt_to_gdp, color = bucket)) +\n    geom_line() +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    labs(x=\"\", y = \"\", title = \"Avg. Debt-to-GDP\", color = \"\") +\n    scale_y_continuous(labels = scales::label_percent()) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-16-1.png){width=1152}\n:::\n:::\n\n:::\n\nWhile the data is not crystal clear, the above generally corroborates the idea that financial bubbles have formed during times of increased leverage. Again, let's try to represent the data in a more concise and standard fashion.\n\n#### Creating a Debt Metric\n\nLet's create a standard `Debt Metric` by:\n\n1.  Calculating the distance of each of these ratios from a median line\n2.  Dividing this distance by the average absolute distance from the median line\n3.  Averaging the standardized distances for Metric 1 & Metric 2 with the respective weights of 90% and 10%*\\**\n\n::: column-margin\n*\\*Metric 1 is more stationary and cyclical; therefore, we are giving it a greater weight as it will be more reliable when measuring absolute debt levels.*\n:::\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nd_e_stand_dist_tbl <- r3000_nested %>% \n    select(date:bucket, -year, balance_sheet, classification) %>% \n    unnest(c(balance_sheet, classification)) %>% \n    mutate(d_e = (st_debt + lt_debt) / total_equity) %>% \n    select(date:bucket, classification_1, d_e) %>% \n    group_by(date, classification_1, bucket) %>% \n    summarize(d_e = median(d_e, na.rm = T)) %>% \n    ungroup() %>% \n    group_by(classification_1, bucket) %>% \n    mutate(med_value = median(d_e)) %>% \n    mutate(distance = d_e - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(d_e_standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    select(date:bucket, d_e_standardized_distance)\n\nd_gdp_stand_dist_tbl <- r3000_nested %>%\n    select(date:bucket, -year, balance_sheet, classification) %>%\n    unnest(c(balance_sheet, classification)) %>%\n    select(date:bucket, classification_1, total_debt) %>%\n    filter(!is.na(total_debt)) %>%\n    group_by(date, classification_1, bucket) %>%\n    summarize(\n        sum_debt = sum(total_debt, na.rm = T),\n        count = n()\n    ) %>%\n    ungroup() %>%\n    left_join(gdp) %>%\n    mutate(avg_debt_to_gdp = ((sum_debt / count) / gdp)) %>% \n    group_by(classification_1, bucket) %>% \n    mutate(med_value = median(avg_debt_to_gdp, na.rm = T)) %>% \n    mutate(distance = avg_debt_to_gdp - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(d_gdp_standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    select(date:bucket, d_gdp_standardized_distance)\n\nd_e_stand_dist_tbl %>% \n    left_join(d_gdp_stand_dist_tbl) %>% \n    mutate(debt_metric = (.9 * d_e_standardized_distance) + (.1 * d_gdp_standardized_distance)) %>% \n    ggplot(aes(date, debt_metric, color = bucket)) +\n    geom_line() +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    labs(x=\"\", y = \"\", title = \"Debt Metric\", color = \"\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-17-1.png){width=1152}\n:::\n:::\n\n\n#### Creating a Debt Growth Metric\n\nLike in the previous section, let's create a `Debt Growth Metric` by:\n\n1.  Calculating the year-over-year change for both Metrics 1 & 2\n2.  Calculate the distance of this year-over-year change from a median line\n3.  Divide this distance by the average absolute distance from the median line\n4.  Averaging the standardized distances for Metric 1 & Metric 2 together to a create a single `Debt Growth Metric`\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ndelta_d_e_stand_dist_tbl <- r3000_nested %>% \n    select(date:bucket, -year, balance_sheet, classification) %>% \n    unnest(c(balance_sheet, classification)) %>% \n    mutate(d_e = (st_debt + lt_debt) / total_equity) %>% \n    select(date:bucket, classification_1, d_e) %>% \n    group_by(date, classification_1, bucket) %>% \n    summarize(d_e = median(d_e, na.rm = T)) %>% \n    ungroup() %>% \n    group_by(classification_1, bucket) %>% \n    mutate(delta_d_e = d_e - lag(d_e)) %>% \n    ungroup() %>% \n    drop_na() %>% \n    group_by(classification_1, bucket) %>% \n    mutate(med_value = median(delta_d_e)) %>% \n    mutate(distance = delta_d_e - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(delta_d_e_standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    select(date:bucket, delta_d_e_standardized_distance)\n\ndelta_d_gdp_stand_dist_tbl <- r3000_nested %>%\n    select(date:bucket, -year, balance_sheet, classification) %>%\n    unnest(c(balance_sheet, classification)) %>%\n    select(date:bucket, classification_1, total_debt) %>%\n    filter(!is.na(total_debt)) %>%\n    group_by(date, classification_1, bucket) %>%\n    summarize(\n        sum_debt = sum(total_debt, na.rm = T),\n        count = n()\n    ) %>%\n    ungroup() %>%\n    left_join(gdp) %>%\n    mutate(avg_debt_to_gdp = ((sum_debt / count) / gdp)) %>% \n    group_by(classification_1, bucket) %>% \n    mutate(delta_avg_debt_to_gdp = avg_debt_to_gdp - lag(avg_debt_to_gdp)) %>% \n    drop_na() %>% \n    mutate(med_value = median(delta_avg_debt_to_gdp, na.rm = T)) %>% \n    mutate(distance = delta_avg_debt_to_gdp - med_value) %>% \n    mutate(avg_distance = mean(abs(distance), na.rm = T)) %>% \n    mutate(delta_d_gdp_standardized_distance = distance / avg_distance) %>% \n    ungroup() %>% \n    select(date:bucket, delta_d_gdp_standardized_distance)\n\ndelta_d_e_stand_dist_tbl %>% \n    left_join(delta_d_gdp_stand_dist_tbl) %>% \n    mutate(debt_growth_metric = (.5 * delta_d_e_standardized_distance) + (.5 * delta_d_gdp_standardized_distance)) %>% \n    ggplot(aes(date, debt_growth_metric, color = bucket)) +\n    geom_line() +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    labs(x=\"\", y = \"\", title = \"Debt Growth Metric\", color = \"\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-18-1.png){width=1152}\n:::\n:::\n\n\n##### Takeaways:\n\nLet's repeat our process and identify time periods where debt levels were high in each sector:\n\n+------------------------+-----------------------------------+\n| Sector                 | Time Periods                      |\n+========================+===================================+\n| Communications         | '97 - '99, '02, '10, '18 - '21    |\n+------------------------+-----------------------------------+\n| Consumer Discretionary | '18, '20-'22                      |\n+------------------------+-----------------------------------+\n| Consumer Staples       |                                   |\n+------------------------+-----------------------------------+\n| Energy                 | '01, '03, '19 - '22               |\n+------------------------+-----------------------------------+\n| Financials             | '01 - '09                         |\n+------------------------+-----------------------------------+\n| Health Care            | '18 - '23                         |\n+------------------------+-----------------------------------+\n| Industrials            | '09, '19-'23                      |\n+------------------------+-----------------------------------+\n| Materials              | '01 - '03, '15, '21               |\n+------------------------+-----------------------------------+\n| Real Estate            | '08-'10                           |\n+------------------------+-----------------------------------+\n| Technology             | '18 - '23                         |\n+------------------------+-----------------------------------+\n| Utilities              | '03 - '05, '18 - '23              |\n+------------------------+-----------------------------------+\n\n#### Digging Deeper\n\nOnce again, we can take a more granular look at the data:\n\n\n\n\n\n::: panel-tabset\n##### Debt Metric\n\n::: panel-tabset\n\n\n```{.r .cell-code}\nplots <- list()\nfor (i in seq_along(classification_1_vec)){\n\n    g <- start_tbl %>% \n        filter(classification_1 == classification_1_vec[i]) %>% \n        mutate(d_e = total_debt / total_equity) %>% \n        group_by(date, classification_3) %>% \n        summarize(d_e = median(d_e, na.rm = T)) %>% \n        ungroup() %>% \n        group_by(classification_3) %>% \n        mutate(\n            med_d_e = median(d_e, na.rm = T),\n            distance = d_e - med_d_e,\n            avg_distance = mean(abs(distance), na.rm = T),\n            d_e_standardized_distance = distance / avg_distance\n        ) %>% \n        ungroup() %>% \n        select(date, classification_3, d_e_standardized_distance) %>% \n        left_join(\n            start_tbl %>% \n        filter(classification_1 == classification_1_vec[i]) %>% \n        drop_na() %>% \n        group_by(date, classification_3) %>% \n        summarize(\n            sum_debt = sum(total_debt, na.rm = T),\n            count = n()\n        ) %>% \n        ungroup() %>% \n        left_join(gdp) %>% \n        mutate(avg_debt_to_gdp = ((sum_debt / count) / gdp)) %>% \n        group_by(classification_3) %>% \n        mutate(\n            med_value = median(avg_debt_to_gdp, na.rm = T),\n            distance = avg_debt_to_gdp - med_value,\n            avg_distance = mean(abs(distance), na.rm = T),\n            d_gdp_standardized_distance = distance / avg_distance\n        ) %>% \n        ungroup() %>% \n        select(date, classification_3, d_gdp_standardized_distance)\n        ) %>% \n        mutate(debt_metric = (.9 * d_e_standardized_distance) + (.1 * d_gdp_standardized_distance)) %>% \n        ggplot(aes(date, debt_metric)) +\n        geom_line() +\n        geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n        theme_tq(base_size = 24) +\n        scale_color_tq() +\n        facet_wrap(~classification_3, scales = \"free\", ncol = 2) +\n        labs(x=\"\", y = \"\", title = \"Debt Metric\", color = \"\") +\n        scale_y_continuous(labels = scales::label_number()) +\n        scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n        theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n    \n    plots[[classification_1_vec[i]]] <- g\n    \n}\n\niwalk(plots, ~ {\n  cat('## ', .y, '\\n\\n')\n  \n  print(.x)\n  \n  cat('\\n\\n')\n  \n})\n```\n\n##  Health Care \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-1.png){width=1152}\n:::\n\n\n\n##  Materials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-2.png){width=1152}\n:::\n\n\n\n##  Industrials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-3.png){width=1152}\n:::\n\n\n\n##  Consumer Discretionary \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-4.png){width=1152}\n:::\n\n\n\n##  Technology \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-5.png){width=1152}\n:::\n\n\n\n##  Real Estate \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-6.png){width=1152}\n:::\n\n\n\n##  Financials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-7.png){width=1152}\n:::\n\n\n\n##  Communications \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-8.png){width=1152}\n:::\n\n\n\n##  Energy \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-9.png){width=1152}\n:::\n\n\n\n##  Consumer Staples \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-10.png){width=1152}\n:::\n\n\n\n##  Utilities \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-20-11.png){width=1152}\n:::\n\n:::\n\n##### Debt Growth Metric\n\n::: panel-tabset\n\n\n```{.r .cell-code}\nplots <- list()\nfor (i in seq_along(classification_1_vec)){\n\n    g <- start_tbl %>% \n        filter(classification_1 == classification_1_vec[i]) %>% \n        mutate(d_e = total_debt / total_equity) %>% \n        group_by(date, classification_3) %>% \n        summarize(d_e = median(d_e, na.rm = T)) %>% \n        ungroup() %>% \n        group_by(classification_3) %>% \n        mutate(\n            delta_d_e = d_e - lag(d_e),\n            med_delta_d_e = median(delta_d_e, na.rm = T),\n            distance = delta_d_e - med_delta_d_e,\n            avg_distance = mean(abs(distance), na.rm = T),\n            delta_d_e_standardized_distance = distance / avg_distance\n        ) %>% \n        ungroup() %>% \n        select(date, classification_3, delta_d_e_standardized_distance) %>% \n        left_join(\n            start_tbl %>% \n        filter(classification_1 == classification_1_vec[i]) %>% \n        drop_na() %>% \n        group_by(date, classification_3) %>% \n        summarize(\n            sum_debt = sum(total_debt, na.rm = T),\n            count = n()\n        ) %>% \n        ungroup() %>% \n        left_join(gdp) %>% \n        mutate(avg_debt_to_gdp = ((sum_debt / count) / gdp)) %>% \n        group_by(classification_3) %>% \n        mutate(\n            delta_avg_debt_to_gdp = avg_debt_to_gdp - lag(avg_debt_to_gdp),\n            med_value = median(delta_avg_debt_to_gdp, na.rm = T),\n            distance = delta_avg_debt_to_gdp - med_value,\n            avg_distance = mean(abs(distance), na.rm = T),\n            delta_d_gdp_standardized_distance = distance / avg_distance\n        ) %>% \n        ungroup() %>% \n        select(date, classification_3, delta_d_gdp_standardized_distance)\n        ) %>% \n        mutate(debt_growth_metric = (.5 * delta_d_e_standardized_distance) + (.5 * delta_d_gdp_standardized_distance)) %>% \n        ggplot(aes(date, debt_growth_metric)) +\n        geom_line() +\n        geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n        theme_tq(base_size = 24) +\n        scale_color_tq() +\n        facet_wrap(~classification_3, scales = \"free\", ncol = 2) +\n        labs(x=\"\", y = \"\", title = \"Debt Metric\", color = \"\") +\n        scale_y_continuous(labels = scales::label_number()) +\n        scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n        theme(legend.position = \"top\", plot.title = element_text(hjust = .5))\n    \n    plots[[classification_1_vec[i]]] <- g\n    \n}\n\niwalk(plots, ~ {\n  cat('## ', .y, '\\n\\n')\n  \n  print(.x)\n  \n  cat('\\n\\n')\n  \n})\n```\n\n##  Health Care \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-1.png){width=1152}\n:::\n\n\n\n##  Materials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-2.png){width=1152}\n:::\n\n\n\n##  Industrials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-3.png){width=1152}\n:::\n\n\n\n##  Consumer Discretionary \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-4.png){width=1152}\n:::\n\n\n\n##  Technology \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-5.png){width=1152}\n:::\n\n\n\n##  Real Estate \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-6.png){width=1152}\n:::\n\n\n\n##  Financials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-7.png){width=1152}\n:::\n\n\n\n##  Communications \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-8.png){width=1152}\n:::\n\n\n\n##  Energy \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-9.png){width=1152}\n:::\n\n\n\n##  Consumer Staples \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-10.png){width=1152}\n:::\n\n\n\n##  Utilities \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-21-11.png){width=1152}\n:::\n\n:::\n:::\n\n<hr>\n\n### 3) New Entrants to the Market\n\nThere are several ways that we can assess whether new players are entering markets. The most direct and simple method is to track when private companies become public (i.e. IPO data). Let's track IPO activity by:\n\n1.  Counting the \\# of IPOs each month\n2.  Summing the IPO Offer Size each month\n\n::: panel-tabset\n### IPO Count\n\n::: panel-tabset\n#### Aggregate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    count(date) %>% \n    ggplot(aes(date, n)) +\n    geom_col(color = palette_light()[1]) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"# of IPOs\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-22-1.png){width=768}\n:::\n:::\n\n\n#### Sector-Level\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>%\n    filter(classification_1 != \"Unclassifiable\") %>% \n    mutate(date = floor_date(announced_date, unit = \"month\")) %>%\n    count(date, classification_1) %>%\n    ggplot(aes(date, n)) +\n    geom_col(color = palette_light()[1]) +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y = \"\", title = \"# of IPOs\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-23-1.png){width=1152}\n:::\n:::\n\n:::\n\n### Sum Offer Size (\\$)\n\n::: panel-tabset\n#### Aggregate\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollar_deflator_2022_tbl <- read_rds(here(\"raw_data\", \"Financial Bubbles\", \"dollar_deflator_2022.rds\"))\n\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date) %>% \n    summarize(offer_size = sum(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"Sum of IPO Offer Sizes in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = .1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-24-1.png){width=768}\n:::\n:::\n\n\n#### Sector-Level\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date, classification_1) %>% \n    summarize(offer_size = sum(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"IPO Offer Size in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = .1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-25-1.png){width=1152}\n:::\n:::\n\n:::\n\n### Avg Offer Size (\\$)\n\n::: panel-tabset\n#### Aggregate\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollar_deflator_2022_tbl <- read_rds(here(\"raw_data\", \"Financial Bubbles\", \"dollar_deflator_2022.rds\"))\n\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date) %>% \n    summarize(offer_size = mean(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"Average IPO Offer Size in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = .1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-26-1.png){width=768}\n:::\n:::\n\n\n#### Sector-Level\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date, classification_1) %>% \n    summarize(offer_size = mean(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"Average IPO Offer Size in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = 1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-27-1.png){width=1152}\n:::\n:::\n\n:::\n\n### Median Offer Size (\\$)\n\n::: panel-tabset\n#### Aggregate\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollar_deflator_2022_tbl <- read_rds(here(\"raw_data\", \"Financial Bubbles\", \"dollar_deflator_2022.rds\"))\n\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date) %>% \n    summarize(offer_size = median(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"Median IPO Offer Size in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = .1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-28-1.png){width=768}\n:::\n:::\n\n\n#### Sector-Level\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date, classification_1) %>% \n    summarize(offer_size = median(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    ggplot(aes(date, real_offer_size)) +\n    geom_col(color = palette_light()[1]) +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    theme_tq(base_size = 16) +\n    labs(\n        x=\"\", y=\"\", title = \"Median IPO Offer Size in 2022 Dollars\", subtitle = \"Monthly Frequency\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, suffix = \"B\", accuracy = 1)) +\n    theme(plot.title = element_text(hjust = .5), plot.subtitle = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-29-1.png){width=1152}\n:::\n:::\n\n:::\n:::\n\nFrom eye-balling the data, we notice that IPO data is a helpful indicator when assessing if markets are growing past capacity. We notice that the count of monthly IPOs is somewhat cyclical with peaks before time periods typically associated with financial bubbles ('01, '08, '22).\n\n#### Creating an IPO Metric\n\nLet's create a standard `IPO Metric` by:\n\n1.  Calculating the distance between a 3-month rolling average and a 4-year rolling average of IPO Count & Avg. Offer Size\n2.  Calculating a standardized distance for both of these rolling averages\n3.  Averaging the standardized distances together to a create a single `IPO Metric`\n\nBy doing this we will have a rough estimation of how 'hot' markets are and if the number of entrants is high relative to historical averages:\n\n::: panel-tabset\n#### Aggregate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    count(date) %>% \n    tk_augment_slidify(\n        .value = n,\n        .period = c(3, 48),\n        .f = ~mean(.x),\n        .partial = T,\n        .align = \"right\"\n    ) %>% \n    mutate(distance = n_roll_3 - n_roll_48) %>% \n    mutate(\n        avg_dist = mean(distance),\n        mad_dist = mad(distance),\n        count_standardized_distance = (distance - avg_dist) / mad_dist\n    ) %>% \n    select(date, count_standardized_distance) %>% \n    \n    left_join(\n        ipo_data %>% \n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    group_by(date) %>% \n    summarize(offer_size = mean(offer_size)) %>% \n    left_join(dollar_deflator_2022_tbl) %>% \n    mutate(real_offer_size = offer_size / deflator) %>% \n    select(date, real_offer_size) %>% \n    tk_augment_slidify(\n        .value = real_offer_size,\n        .period = c(3, 48),\n        .f = ~mean(.x),\n        .partial = T,\n        .align = \"right\"\n    ) %>% \n    mutate(distance = real_offer_size_roll_3 - real_offer_size_roll_48) %>% \n    drop_na() %>% \n    mutate(\n        avg_dist = mean(distance),\n        mad_dist = mad(distance),\n        real_offer_size_standardized_distance = (distance - avg_dist) / mad_dist\n    ) %>% \n    select(date, real_offer_size_standardized_distance)\n    ) %>% \n    \n    mutate(ipo_metric = (.5 * count_standardized_distance) + (.5 * real_offer_size_standardized_distance)) %>% \n    ggplot(aes(date, ipo_metric)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    labs(\n        x=\"\", y=\"\", title = \"IPO Metric\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    theme(plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-30-1.png){width=768}\n:::\n:::\n\n\n#### Sector-Level\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nipo_data %>%\n    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n    count(date, classification_1) %>% \n    group_by(classification_1) %>% \n    tk_augment_slidify(\n        .value = n,\n        .period = c(3, 48),\n        .f = ~median(.x),\n        .partial = T,\n        .align = \"right\"\n    ) %>% \n    mutate(distance = n_roll_3 - n_roll_48) %>% \n    mutate(\n        avg_dist = mean(distance),\n        mad_dist = mad(distance),\n        count_standardized_distance = (distance - avg_dist) / mad_dist\n    ) %>% \n    ungroup() %>% \n    select(date, classification_1, count_standardized_distance) %>% \n    \n    left_join(\n        ipo_data %>% \n            mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n            group_by(date, classification_1) %>% \n            summarize(offer_size = mean(offer_size)) %>% \n            ungroup() %>% \n            left_join(dollar_deflator_2022_tbl) %>% \n            mutate(real_offer_size = offer_size / deflator) %>% \n            select(date, classification_1, real_offer_size) %>% \n            group_by(classification_1) %>% \n            tk_augment_slidify(\n                .value = real_offer_size,\n                .period = c(3, 48),\n                .f = ~median(.x),\n                .partial = T,\n                .align = \"right\"\n            ) %>% \n            mutate(distance = real_offer_size_roll_3 - real_offer_size_roll_48) %>% \n            drop_na() %>% \n            mutate(\n                avg_dist = mean(distance),\n                mad_dist = mad(distance),\n                real_offer_size_standardized_distance = (distance - avg_dist) / mad_dist\n            ) %>% \n            ungroup() %>% \n            select(date, classification_1, real_offer_size_standardized_distance)\n    ) %>% \n    \n    mutate(ipo_metric = (.5 * count_standardized_distance) + (.5 * real_offer_size_standardized_distance)) %>% \n    ggplot(aes(date, ipo_metric)) +\n    geom_line() +\n    geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n    facet_wrap(~classification_1, scales = \"free\", ncol = 3) +\n    theme_tq(base_size = 16) +\n    scale_color_tq() +\n    labs(\n        x=\"\", y=\"\", title = \"IPO Metric\"\n    ) +\n    scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n    scale_y_continuous(labels = scales::label_number()) +\n    theme(plot.title = element_text(hjust = .5))\n```\n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-31-1.png){width=1152}\n:::\n:::\n\n:::\n\n<hr>\n\n#### Digging Deeper\n\nOnce again, let's take a more granular look at the data:\n\n:::panel-tabset\n\n\n\n```{.r .cell-code}\nplots <- list()\nfor (i in seq_along(classification_1_vec)){\n    \n    g <- ipo_data %>% \n        filter(classification_1 == classification_1_vec[i]) %>% \n        mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n        count(date, classification_3) %>% \n        group_by(classification_3) %>% \n        tk_augment_slidify(\n            .value = n,\n            .period = c(3, 48),\n            .f = ~median(.x),\n            .partial = T,\n            .align = \"right\"\n        ) %>% \n        mutate(distance = n_roll_3 - n_roll_48) %>% \n        mutate(\n            avg_dist = mean(distance),\n            mad_dist = mad(distance),\n            count_standardized_distance = (distance - avg_dist) / mad_dist\n        ) %>% \n        ungroup() %>% \n        select(date, classification_3, count_standardized_distance) %>% \n        \n        left_join(\n            ipo_data %>% \n                filter(classification_1 == classification_1_vec[i]) %>% \n                    mutate(date = floor_date(announced_date, unit = \"month\")) %>% \n                    group_by(date, classification_3) %>% \n                    summarize(offer_size = mean(offer_size)) %>% \n                    ungroup() %>% \n                    left_join(dollar_deflator_2022_tbl) %>% \n                    mutate(real_offer_size = offer_size / deflator) %>% \n                    select(date, classification_3, real_offer_size) %>% \n                    group_by(classification_3) %>% \n                    tk_augment_slidify(\n                        .value = real_offer_size,\n                        .period = c(3, 48),\n                        .f = ~median(.x),\n                        .partial = T,\n                        .align = \"right\"\n                    ) %>% \n                    mutate(distance = real_offer_size_roll_3 - real_offer_size_roll_48) %>% \n                    drop_na() %>% \n                    mutate(\n                        avg_dist = mean(distance),\n                        mad_dist = mad(distance),\n                        real_offer_size_standardized_distance = (distance - avg_dist) / mad_dist\n                    ) %>% \n                    ungroup() %>% \n                    select(date, classification_3, real_offer_size_standardized_distance)\n        ) %>% \n        \n            mutate(ipo_metric = (.5 * count_standardized_distance) + (.5 * real_offer_size_standardized_distance)) %>% \n            ggplot(aes(date, ipo_metric)) +\n            geom_line() +\n            geom_hline(yintercept = 0, color = \"black\", lty = 2) +\n            facet_wrap(~classification_3, scales = \"free\", ncol = 2) +\n            theme_tq(base_size = 24) +\n            scale_color_tq() +\n            labs(\n                x=\"\", y=\"\", title = \"IPO Metric\"\n            ) +\n            scale_x_date(labels = scales::label_date(format = \"'%y\"), date_breaks = \"5 years\") +\n            scale_y_continuous(labels = scales::label_number()) +\n        theme(plot.title = element_text(hjust = .5))\n    \n    plots[[classification_1_vec[i]]] <- g\n    \n}\n\niwalk(plots, ~ {\n  cat('## ', .y, '\\n\\n')\n  \n  print(.x)\n  \n  cat('\\n\\n')\n  \n})\n```\n\n##  Health Care \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-1.png){width=1152}\n:::\n\n\n\n##  Materials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-2.png){width=1152}\n:::\n\n\n\n##  Industrials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-3.png){width=1152}\n:::\n\n\n\n##  Consumer Discretionary \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-4.png){width=1152}\n:::\n\n\n\n##  Technology \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-5.png){width=1152}\n:::\n\n\n\n##  Real Estate \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-6.png){width=1152}\n:::\n\n\n\n##  Financials \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-7.png){width=1152}\n:::\n\n\n\n##  Communications \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-8.png){width=1152}\n:::\n\n\n\n##  Energy \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-9.png){width=1152}\n:::\n\n\n\n##  Consumer Staples \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-10.png){width=1152}\n:::\n\n\n\n##  Utilities \n\n::: {.cell-output-display}\n![](financial_bubbles_files/figure-html/unnamed-chunk-32-11.png){width=1152}\n:::\n\n\n:::\n\nFrom observing the above at Sector Level 3, we notice that the IPO metric behaves oddly for several segments. This odd behavior is the result of limited IPO data for those segments and we will have to address this when creating our grand summary `Financial Bubble Metric`.\n\n### 4) Tightening Risks Popping the Bubble\n\n## Putting It All Together\n\n##### Final Remarks\n\n*The above is intended as an exploration of historical data, and all statements and opinions are expressly my own; neither should be construed as investment advice.*\n",
    "supporting": [
      "financial_bubbles_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}