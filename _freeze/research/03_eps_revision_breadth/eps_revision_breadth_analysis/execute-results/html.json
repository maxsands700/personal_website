{
  "hash": "b6577784c2887bbec73f93af6b4b56ee",
  "result": {
    "markdown": "---\ntitle: \"★EPS Revision Breadth Analysis\"\nauthor: \"Max Sands\"\ndate: \"2023-02-05\"\nimage: preview_image.jpeg\ndescription: \"Read Time: 10-15 mins\"\ncategories: [Equities, ★]\neditor_options: \n  chunk_output_type: console\nwarning: false\nmessage: false\n---\n\n\n\n\n## What is EPS Revision Breadth?\n\nEPS Revision Breadth is a financial metric that measures the number of upward (positive) and downward (negative) revisions to earnings per share (EPS) estimates by analysts. It is calculated as the difference between the number of positive and negative revisions divided by the total number of revisions made.\n\nSo, if we consider 30 analysts, 20 of whom revised their earnings estimates upwards, and 10 of whom revised their earnings downwards, this would yield an EPS Revision Breadth of 33%.\n\nThis metric is important because it provides insight into the market's confidence in a company's earnings. A high breadth of positive revisions to EPS estimates indicates that analysts are becoming more optimistic about the company's future earnings, which can be a sign of increased investor confidence and a potential increase in the company's stock price. Conversely, a high breadth of negative revisions to EPS estimates can indicate declining investor confidence and a potential decrease in the company's stock price.\n\nAs a result, EPS Revision Breadth has the potential to be a useful indicator for investors to assess the market's sentiment towards a company's earnings and make informed investment decisions. In the following, we will investigate EPS Revision Breadth for the SP500 as a whole, rather than for specific companies.\n\n## Thesis\n\nIdentifying tops and bottoms in EPS Revision Breadth can aid in distinguishing periods of strong vs. weak equity returns.\n\n## Data Overview\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_raw %>% \n    head() %>% \n    set_names(c(\"date\", \"EPS Revision Breadth\", \"SP500 Price\")) %>% \n    gt(rowname_col = \"date\") %>% \n    fmt_percent(columns = 2, decimals = 1) %>% \n    fmt_currency(columns = 3, decimals = 0)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"vfwwwmlcvi\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#vfwwwmlcvi .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vfwwwmlcvi .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vfwwwmlcvi .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vfwwwmlcvi .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vfwwwmlcvi .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vfwwwmlcvi .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vfwwwmlcvi .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vfwwwmlcvi .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vfwwwmlcvi .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vfwwwmlcvi .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vfwwwmlcvi .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vfwwwmlcvi .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vfwwwmlcvi .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vfwwwmlcvi .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vfwwwmlcvi .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vfwwwmlcvi .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vfwwwmlcvi .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vfwwwmlcvi .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vfwwwmlcvi .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vfwwwmlcvi .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vfwwwmlcvi .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vfwwwmlcvi .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vfwwwmlcvi .gt_left {\n  text-align: left;\n}\n\n#vfwwwmlcvi .gt_center {\n  text-align: center;\n}\n\n#vfwwwmlcvi .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vfwwwmlcvi .gt_font_normal {\n  font-weight: normal;\n}\n\n#vfwwwmlcvi .gt_font_bold {\n  font-weight: bold;\n}\n\n#vfwwwmlcvi .gt_font_italic {\n  font-style: italic;\n}\n\n#vfwwwmlcvi .gt_super {\n  font-size: 65%;\n}\n\n#vfwwwmlcvi .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#vfwwwmlcvi .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#vfwwwmlcvi .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vfwwwmlcvi .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#vfwwwmlcvi .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#vfwwwmlcvi .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">EPS Revision Breadth</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">SP500 Price</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-30</td>\n<td class=\"gt_row gt_right\">&minus;15.2%</td>\n<td class=\"gt_row gt_right\">$4,018</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-27</td>\n<td class=\"gt_row gt_right\">&minus;15.7%</td>\n<td class=\"gt_row gt_right\">$4,071</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-26</td>\n<td class=\"gt_row gt_right\">&minus;15.4%</td>\n<td class=\"gt_row gt_right\">$4,060</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-25</td>\n<td class=\"gt_row gt_right\">&minus;15.1%</td>\n<td class=\"gt_row gt_right\">$4,016</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-24</td>\n<td class=\"gt_row gt_right\">&minus;13.8%</td>\n<td class=\"gt_row gt_right\">$4,017</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">2023-01-23</td>\n<td class=\"gt_row gt_right\">&minus;13.7%</td>\n<td class=\"gt_row gt_right\">$4,020</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n## EPS Revisions: Identifying Tops & Bottoms\n\nSince this data is cyclical and stationary, we can attempt to identify tops and bottoms, most simply, by partitioning the data into buckets based on its EPS Revision Breadth Value. The following chart demonstrates this by highlighting the top 10% of EPS RB in orange, and the bottom 10% in blue:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_raw_bucketed <- data_raw %>% \n    mutate(quantile = ntile(eps_revision_breadth, n = 10)) %>% \n    arrange(date)\n\nmajor_troughs_tbl <- tibble(\n    start_date = c(ymd(\"2008-09-01\"), ymd(\"2020-03-01\")),\n    end_date   = c(ymd(\"2009-06-01\"), ymd(\"2020-07-10\"))\n)\n\n\nggplot() +\n    geom_line(\n        data = data_raw_bucketed,\n        mapping = aes(date, eps_revision_breadth)\n    ) +\n    geom_point(\n        data = data_raw_bucketed %>% \n            filter(quantile == 10),\n        mapping = aes(date, eps_revision_breadth),\n        color = \"darkorange\"\n    ) +\n    geom_point(\n        data = data_raw_bucketed %>% \n            filter(quantile == 1),\n        mapping = aes(date, eps_revision_breadth),\n        color = \"midnightblue\"\n    ) +\n    geom_rect(\n        data = major_troughs_tbl,\n        mapping = aes(xmin = start_date, xmax = end_date, ymin = -Inf, ymax = Inf),\n        fill = \"darkred\",\n        alpha = .3\n    ) +\n    labs(\n        x = \"\",\n        y = \"\",\n        title = \"EPS Revision Breadth (%)\"\n    ) +\n    theme_tq() +\n    scale_y_continuous(labels = scales::percent_format()) +\n    theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![Major Troughs are shaded in red](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\nAs we can see from the plot, highlighting the top and bottom 10% of values adequately identifies the peaks and troughs in the time series. However we clearly need to address the fact that *the troughs similar to those identified in 2015 are systematically different from those that occur in 2008 and 2020 (shaded in red)*. We will therefore categorize troughs into two groups, which should be treated and analyzed differently:\n\n1.  Minor Troughs that arise as a natural artifact of the business cycle\n\n2.  Major Troughs that arise due to periods of extreme economic turbulence, typically after the popping of a financial bubble\n\nThe ability to distinguish between these two types of troughs is essential because it is unlikely that returns before, during, and after Major Troughs are similar to those for Minor troughs.\n\nWhile we won't dive into predicting when these Major Troughs occur here, I believe that tracking sector-level debt, the velocity & acceleration of that debt, and the speed, ability, and ease in which major players in those sectors can service their debt, is a key ingredient in modelling this out (see [Bridgewater](https://www.bridgewater.com/) Research).\n\nAs such a basic decision tree could look as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmermaid(\"\ngraph TD\n\nA(EPS RB < 10th Percentile?)-- No --> B[Not a Trough]\nB --> Z(Act accordingly...)\nA -- Yes --> C(Does separate model that includes Debt levels etc. indicate a Major Trough?)\n\nC -- No --> D[Minor Trough]\nC -- Yes --> E[Major Trough]\n\nD --> F(Act accordingly...)\nE --> G(Act accordingly...)\n\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-915fbb880e3136120717\" style=\"width:100%;height:464px;\" class=\"DiagrammeR html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-915fbb880e3136120717\">{\"x\":{\"diagram\":\"\\ngraph TD\\n\\nA(EPS RB < 10th Percentile?)-- No --> B[Not a Trough]\\nB --> Z(Act accordingly...)\\nA -- Yes --> C(Does separate model that includes Debt levels etc. indicate a Major Trough?)\\n\\nC -- No --> D[Minor Trough]\\nC -- Yes --> E[Major Trough]\\n\\nD --> F(Act accordingly...)\\nE --> G(Act accordingly...)\\n\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Return Analysis\n\nLets identify average 1M, 3M, 6M, and 1YR returns, had you invested at points during a peak or trough in EPS RB:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreturn_summary_tbl_incl_major <- data_raw_bucketed %>% \n    mutate(\n        month_1_ret = (sp500_price / lag(sp500_price, n=25) - 1),\n        month_3_ret = (sp500_price / lag(sp500_price, n=25*3) - 1),\n        month_6_ret = (sp500_price / lag(sp500_price, n=25*6) - 1),\n        month_12_ret = (sp500_price / lag(sp500_price, n=25*12) - 1)\n    ) %>% \n    group_by(quantile) %>% \n    summarize(across(.cols = contains(\"month\"), .fns = ~mean(.x, na.rm = T)))\n\nreturn_summary_tbl_excl_major <- data_raw_bucketed %>% \n    mutate(\n        month_1_ret = (sp500_price / lag(sp500_price, n=25) - 1),\n        month_3_ret = (sp500_price / lag(sp500_price, n=25*3) - 1),\n        month_6_ret = (sp500_price / lag(sp500_price, n=25*6) - 1),\n        month_12_ret = (sp500_price / lag(sp500_price, n=25*12) - 1)\n    ) %>% \n    group_by(quantile) %>% \n    # filter out major trough time periods\n    filter(!(date %>% between(ymd(\"2008-09-01\"), ymd(\"2009-06-01\")))) %>%\n    filter(!(date %>% between(ymd(\"2020-03-01\"), ymd(\"2020-07-10\")))) %>% \n    summarize(across(.cols = contains(\"month\"), .fns = ~mean(.x, na.rm = T)))\n```\n:::\n\n\n::: panel-tabset\n### Visual\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreturn_summary_tbl_excl_major %>% \n    set_names(names(.) %>% str_replace_all(., \"_\", \" \") %>% str_to_title()) %>% \n    pivot_longer(cols = -Quantile, names_to = \"Time Horizon\", values_to = \"Return_excl\") %>% \n    bind_cols(return_summary_tbl_incl_major %>% \n                   set_names(names(.) %>% str_replace_all(., \"_\", \" \") %>% str_to_title()) %>% \n                   pivot_longer(cols = -Quantile, names_to = \"Time Horizon\", values_to = \"Return_incl\") %>% \n                   select(Return_incl)) %>% \n    pivot_longer(cols = contains(\"Return\")) %>%\n    mutate(Quantile = as.factor(Quantile),\n           `Time Horizon` = as_factor(`Time Horizon`)) %>% \n    ggplot(aes(Quantile, value)) +\n    geom_col(\n        data = . %>% \n            filter(name == \"Return_excl\"),\n        fill = \"midnightblue\",\n        color = \"black\",\n        alpha = .7\n    ) +\n    geom_point(\n        data = . %>% \n            filter(name == \"Return_incl\"),\n        size = 3,\n        color = \"darkorange\"\n    ) +\n    facet_wrap(~`Time Horizon`, ncol = 1, scales = \"free_y\") +\n    labs(y =\"\", title = \"Returns by Quantile\", subtitle = str_glue(\"Bar = Excluding Major Troughs\n                                                                   Point = Including Major Troughs\")) +\n    theme_tq() +\n    scale_y_continuous(labels = scales::percent_format()) +\n    theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n### Table\n\n::: panel-tabset\n#### Excluding Major Troughs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreturn_summary_tbl_excl_major %>% \n    set_names(names(.) %>% str_replace_all(., \"_\", \" \") %>% str_to_title()) %>% \n    gt() %>% \n    fmt_percent(columns = -Quantile, decimals = 1) %>% \n    tab_header(title = \"SP500 Returns by Quantile of EPS Revision Breadth\",\n               subtitle = \"Excluding Major Troughs\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"riorwshxcw\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#riorwshxcw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#riorwshxcw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#riorwshxcw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#riorwshxcw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#riorwshxcw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#riorwshxcw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#riorwshxcw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#riorwshxcw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#riorwshxcw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#riorwshxcw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#riorwshxcw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#riorwshxcw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#riorwshxcw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#riorwshxcw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#riorwshxcw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#riorwshxcw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#riorwshxcw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#riorwshxcw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#riorwshxcw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#riorwshxcw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#riorwshxcw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#riorwshxcw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#riorwshxcw .gt_left {\n  text-align: left;\n}\n\n#riorwshxcw .gt_center {\n  text-align: center;\n}\n\n#riorwshxcw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#riorwshxcw .gt_font_normal {\n  font-weight: normal;\n}\n\n#riorwshxcw .gt_font_bold {\n  font-weight: bold;\n}\n\n#riorwshxcw .gt_font_italic {\n  font-style: italic;\n}\n\n#riorwshxcw .gt_super {\n  font-size: 65%;\n}\n\n#riorwshxcw .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#riorwshxcw .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#riorwshxcw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#riorwshxcw .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#riorwshxcw .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#riorwshxcw .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  <thead class=\"gt_header\">\n    <tr>\n      <th colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\" style>SP500 Returns by Quantile of EPS Revision Breadth</th>\n    </tr>\n    <tr>\n      <th colspan=\"5\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Excluding Major Troughs</th>\n    </tr>\n  </thead>\n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Quantile</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 1 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 3 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 6 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 12 Ret</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">1.4%</td>\n<td class=\"gt_row gt_right\">&minus;2.3%</td>\n<td class=\"gt_row gt_right\">&minus;4.0%</td>\n<td class=\"gt_row gt_right\">&minus;0.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">1.1%</td>\n<td class=\"gt_row gt_right\">&minus;0.3%</td>\n<td class=\"gt_row gt_right\">0.8%</td>\n<td class=\"gt_row gt_right\">5.8%</td></tr>\n    <tr><td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">1.1%</td>\n<td class=\"gt_row gt_right\">2.4%</td>\n<td class=\"gt_row gt_right\">2.4%</td>\n<td class=\"gt_row gt_right\">9.5%</td></tr>\n    <tr><td class=\"gt_row gt_right\">4</td>\n<td class=\"gt_row gt_right\">0.4%</td>\n<td class=\"gt_row gt_right\">2.7%</td>\n<td class=\"gt_row gt_right\">5.0%</td>\n<td class=\"gt_row gt_right\">10.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">5</td>\n<td class=\"gt_row gt_right\">0.8%</td>\n<td class=\"gt_row gt_right\">4.9%</td>\n<td class=\"gt_row gt_right\">6.8%</td>\n<td class=\"gt_row gt_right\">13.5%</td></tr>\n    <tr><td class=\"gt_row gt_right\">6</td>\n<td class=\"gt_row gt_right\">0.6%</td>\n<td class=\"gt_row gt_right\">4.9%</td>\n<td class=\"gt_row gt_right\">5.7%</td>\n<td class=\"gt_row gt_right\">12.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">7</td>\n<td class=\"gt_row gt_right\">1.6%</td>\n<td class=\"gt_row gt_right\">3.2%</td>\n<td class=\"gt_row gt_right\">7.7%</td>\n<td class=\"gt_row gt_right\">13.6%</td></tr>\n    <tr><td class=\"gt_row gt_right\">8</td>\n<td class=\"gt_row gt_right\">2.0%</td>\n<td class=\"gt_row gt_right\">4.6%</td>\n<td class=\"gt_row gt_right\">10.0%</td>\n<td class=\"gt_row gt_right\">15.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">1.0%</td>\n<td class=\"gt_row gt_right\">5.2%</td>\n<td class=\"gt_row gt_right\">12.3%</td>\n<td class=\"gt_row gt_right\">15.1%</td></tr>\n    <tr><td class=\"gt_row gt_right\">10</td>\n<td class=\"gt_row gt_right\">1.2%</td>\n<td class=\"gt_row gt_right\">6.9%</td>\n<td class=\"gt_row gt_right\">15.6%</td>\n<td class=\"gt_row gt_right\">27.2%</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n#### Including Major Troughs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreturn_summary_tbl_incl_major %>% \n    set_names(names(.) %>% str_replace_all(., \"_\", \" \") %>% str_to_title()) %>% \n    gt() %>% \n    fmt_percent(columns = -Quantile, decimals = 1) %>% \n    tab_header(title = \"SP500 Returns by Quantile of EPS Revision Breadth\",\n               subtitle = \"Including Major Troughs\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"dbqlypptcq\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#dbqlypptcq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dbqlypptcq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dbqlypptcq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dbqlypptcq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dbqlypptcq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dbqlypptcq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dbqlypptcq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dbqlypptcq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dbqlypptcq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dbqlypptcq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dbqlypptcq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dbqlypptcq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dbqlypptcq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dbqlypptcq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dbqlypptcq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dbqlypptcq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dbqlypptcq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dbqlypptcq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dbqlypptcq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dbqlypptcq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dbqlypptcq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dbqlypptcq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dbqlypptcq .gt_left {\n  text-align: left;\n}\n\n#dbqlypptcq .gt_center {\n  text-align: center;\n}\n\n#dbqlypptcq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dbqlypptcq .gt_font_normal {\n  font-weight: normal;\n}\n\n#dbqlypptcq .gt_font_bold {\n  font-weight: bold;\n}\n\n#dbqlypptcq .gt_font_italic {\n  font-style: italic;\n}\n\n#dbqlypptcq .gt_super {\n  font-size: 65%;\n}\n\n#dbqlypptcq .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#dbqlypptcq .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#dbqlypptcq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dbqlypptcq .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#dbqlypptcq .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#dbqlypptcq .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  <thead class=\"gt_header\">\n    <tr>\n      <th colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\" style>SP500 Returns by Quantile of EPS Revision Breadth</th>\n    </tr>\n    <tr>\n      <th colspan=\"5\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Including Major Troughs</th>\n    </tr>\n  </thead>\n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Quantile</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 1 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 3 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 6 Ret</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Month 12 Ret</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">&minus;0.8%</td>\n<td class=\"gt_row gt_right\">&minus;9.0%</td>\n<td class=\"gt_row gt_right\">&minus;13.3%</td>\n<td class=\"gt_row gt_right\">&minus;12.3%</td></tr>\n    <tr><td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">1.0%</td>\n<td class=\"gt_row gt_right\">&minus;0.4%</td>\n<td class=\"gt_row gt_right\">0.2%</td>\n<td class=\"gt_row gt_right\">4.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">1.2%</td>\n<td class=\"gt_row gt_right\">2.8%</td>\n<td class=\"gt_row gt_right\">2.1%</td>\n<td class=\"gt_row gt_right\">8.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">4</td>\n<td class=\"gt_row gt_right\">0.5%</td>\n<td class=\"gt_row gt_right\">2.8%</td>\n<td class=\"gt_row gt_right\">4.9%</td>\n<td class=\"gt_row gt_right\">10.1%</td></tr>\n    <tr><td class=\"gt_row gt_right\">5</td>\n<td class=\"gt_row gt_right\">0.8%</td>\n<td class=\"gt_row gt_right\">4.9%</td>\n<td class=\"gt_row gt_right\">6.8%</td>\n<td class=\"gt_row gt_right\">13.5%</td></tr>\n    <tr><td class=\"gt_row gt_right\">6</td>\n<td class=\"gt_row gt_right\">0.6%</td>\n<td class=\"gt_row gt_right\">4.9%</td>\n<td class=\"gt_row gt_right\">5.7%</td>\n<td class=\"gt_row gt_right\">12.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">7</td>\n<td class=\"gt_row gt_right\">1.6%</td>\n<td class=\"gt_row gt_right\">3.2%</td>\n<td class=\"gt_row gt_right\">7.7%</td>\n<td class=\"gt_row gt_right\">13.6%</td></tr>\n    <tr><td class=\"gt_row gt_right\">8</td>\n<td class=\"gt_row gt_right\">2.0%</td>\n<td class=\"gt_row gt_right\">4.6%</td>\n<td class=\"gt_row gt_right\">10.0%</td>\n<td class=\"gt_row gt_right\">15.7%</td></tr>\n    <tr><td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_right\">1.0%</td>\n<td class=\"gt_row gt_right\">5.2%</td>\n<td class=\"gt_row gt_right\">12.3%</td>\n<td class=\"gt_row gt_right\">15.1%</td></tr>\n    <tr><td class=\"gt_row gt_right\">10</td>\n<td class=\"gt_row gt_right\">1.2%</td>\n<td class=\"gt_row gt_right\">6.9%</td>\n<td class=\"gt_row gt_right\">15.6%</td>\n<td class=\"gt_row gt_right\">27.2%</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n:::\n:::\n\n### Main Takeaway\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtile_1_epsrb_value <- data_raw_bucketed %>% \n    filter(quantile == 1) %>% \n    filter(eps_revision_breadth == max(eps_revision_breadth)) %>% \n    pull(eps_revision_breadth)\n\nqtile_10_epsrb_value <- data_raw_bucketed %>% \n    filter(quantile == 10) %>% \n    filter(eps_revision_breadth == min(eps_revision_breadth)) %>% \n    pull(eps_revision_breadth)\n```\n:::\n\n\nEvidently, during times of lower EPS RB, returns are much lower than those during times when EPS RB is higher (for Time Horizons greater than 1 month). Therefore identifying where we are (and where we will be heading) in the EPS RB cycle is crucial.\n\nFrom what we have seen thus far, we can establish these basic rules of thumb:\n\n1.  When EPS Revision Breadth is below its 10th Percentile (which translates to an EPS RB of approximately -16%), we should consider *underweighting Equities*\n\n2.  When EPS Revision Breadth is above its 90th Percentile (which translates to an EPS RB of approximately 24%), we should consider *overweighting Equities*\n\n3.  When EPS Revision Breadth is between these two values, weight Equities according to personal judgement\n\n## Building an Active Portfolio\n\nLet's utilize our basic heuristics to build an active, long-only portfolio, consisting solely of Equities and Fixed Income, with asset class weights that vary according to EPS Revision Breadth. In other words, the portfolio's allocation to Equities and Fixed Income is a function of EPS Revision Breadth at certain point in time. Therefore, we need to define a function that under-weights Equities during periods of very low EPS Revision Breadth, and does the converse for periods with moderate to high EPS Revision Breadth.\n\nA sample function could look as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_raw_bucketed %>% \n    group_by(quantile) %>% \n    summarize(epsrb_upper_bound = max(eps_revision_breadth)) %>% \n    add_row(quantile = c(0, 11), epsrb_upper_bound = c(-1, 1)) %>% \n    arrange(quantile) %>% \n    add_column(`Equity Allocation` = c(0, 0, 0.05, 0.45, 0.55, 0.70, 0.825, 0.9, 0.925, 0.95, 1, 1)) %>% \n    mutate(`Fixed Income Allocation` = 1-`Equity Allocation`) %>% \n    pivot_longer(contains(\"Allocation\")) %>% \n    ggplot(aes(epsrb_upper_bound, value, color = name)) +\n    geom_point() +\n    geom_line() +\n    scale_x_continuous(labels = scales::percent_format()) +\n    scale_y_continuous(labels = scales::percent_format()) +\n    labs(\n        x = \"EPS Revision Breadth\",\n        y = \"Portfolio Weight\",\n        color = \"\"\n    ) +\n    theme_tq() +\n    scale_color_tq() +\n    theme(legend.position = \"top\", text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\nAs we can see, our function should be bounded between 0 and 1 on the y-axis, and have a similar shape to our 'prototype' above. These are both characteristics of the following function:\n\n$$\nf(x) = \\frac{1-c_3}{1 + e^{-c_1(x - c_2)}} + c_3\n$$\n\nIf we test out a few constants, we see that the values of C1 = 20, C2 = -7.5%, and C3 = 0, generates a function similar to our sample:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsigmoid <- function(x, c1, c2, c3){\n    y <- ((1-c3) / (1 + exp(-c1 * (x - c2)))) + c3\n    \n    return(y)\n}\n\ntibble(\n    eps_rb = seq(-1, 1 ,by=.01),\n    `Equity Allocation` = sigmoid(eps_rb, c1 = 20, c2 = -.075, c3 = 0),\n    `Fixed Income Allocation` = 1-`Equity Allocation`\n) %>% \n    pivot_longer(contains(\"Allocation\")) %>% \n    ggplot(aes(eps_rb, value, color = name)) +\n    geom_line() +\n    scale_x_continuous(labels = scales::percent_format()) +\n    scale_y_continuous(labels = scales::percent_format()) +\n    theme_tq() +\n    scale_color_tq() +\n    labs(\n        x = \"EPS Revision Breadth\", y = \"Portfolio Weight\", title = \"Allocation Function\", subtitle = \"C1 = 20, C2 = -7.5%, C3 = 0\", color = \"\"\n    ) +\n    theme(legend.position = \"top\", text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n### Portfolio Comparison\n\nLet's apply our weighting scheme above and compare its performance to a traditional, static 60/40 Portfolio, an SP500-only Portfolio, and a Fixed-Income-only portfolio. We will consider the iShares Core U.S. Aggregate Bond ETF (\"The AGG\") as a proxy for Fixed Income.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprice_data <- tq_get(c(\"SPY\", \"AGG\"), from = \"2003-09-30\") %>% \n    select(symbol, date, adjusted)\n\nstart_tbl <- price_data %>% \n    group_by(symbol) %>% \n    mutate(pct_ret = (adjusted / lag(adjusted)) - 1) %>% \n    ungroup() %>% \n    select(-adjusted) %>% \n    pivot_wider(names_from = symbol, values_from = pct_ret) %>% \n    left_join(data_raw %>% \n                  select(-sp500_price))\n\nreturns_and_index <- start_tbl %>% \n    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3 = 0),\n           port_fi_weight = 1 - port_equity_weight) %>%\n    \n    drop_na() %>% \n    mutate(portfolio_return = (port_equity_weight * SPY) + (port_fi_weight * AGG),\n           portfolio_60_40_return = (.6 * SPY) + (.4 * AGG)) %>% \n    pivot_longer(cols = c(SPY, AGG, contains(\"portfolio\"))) %>% \n    group_by(name) %>% \n    mutate(price_index = cumprod(1+value)) %>%\n    ungroup() %>% \n    mutate(name = case_when(\n        name == \"SPY\" ~ \"SP500\",\n        name == \"portfolio_60_40_return\" ~ \"60/40 Portfolio\",\n        name == \"portfolio_return\" ~ \"Active Portfolio\",\n        name == \"AGG\" ~ \"AGG\"\n    ))\n\nreturns_and_index %>% \n    ggplot(aes(date, price_index, color = name)) +\n    geom_line() +\n    theme_tq() +\n    scale_color_tq() +\n    theme(legend.position = \"top\", text = element_text(size = 16)) +\n    labs(x = \"\", y = \"Wealth Index ($1)\", color = \"\", title = \"Portfolio Comparison\") +\n    scale_y_continuous(labels = scales::dollar_format())\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\nAs we can see, our portfolio outperforms the traditional 60/40 Portfolio, but under-performs the SP500, on a nominal basis.\n\nHowever, when comparing the returns of these 4 portfolios on a *risk-adjusted* basis, our Active Portfolio fares very well, which means that our portfolio yields the most return per unit of risk.\n\nFor clarification, we consider investment returns as reward, and the standard deviation of returns (volatility) as risk. The Sharpe Ratio divides the average return by the standard deviation of these returns, while the Sortino Ratio divides the average return by the standard deviation of the *negative* returns only.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonthly_returns <- returns_and_index %>% \n    select(date, name, value) %>% \n    mutate(year = year(date),\n           month = month(date)) %>% \n    group_by(month, year, name) %>% \n    mutate(month_return = cumprod(1+value) - 1) %>% \n    slice_tail(n=1) %>% \n    ungroup() %>% \n    group_by(name)\n\nmonthly_returns %>% \n    summarize(\n        mean_monthly_return = mean(month_return),\n        st_dev_monthly_return = sd(month_return)\n    ) %>% \n    left_join(\n       monthly_returns %>% \n           filter(month_return < 0) %>% \n           group_by(name) %>% \n           summarize(downside_st_dev_monthly_return = sd(month_return))\n    ) %>% \n    mutate(sharpe_ratio = mean_monthly_return / st_dev_monthly_return,\n           sortino_ratio = mean_monthly_return / downside_st_dev_monthly_return) %>% \n    arrange(desc(sharpe_ratio)) %>% \n    set_names(names(.) %>% str_remove_all(\"monthly_return\") %>% str_replace_all(\"st_dev\", \"standard deviation\") %>%  str_replace_all(\"_\", \" \") %>% str_to_title()) %>% \n    gt(rowname_col = \"Name\") %>% \n    fmt_percent(columns = 2, decimals = 2) %>% \n    fmt_percent(columns = 3:last_col(), decimals = 1) %>% \n    tab_style(\n        style = cell_text(weight = \"bold\"),\n        locations = cells_body(columns = contains(\"Ratio\"))\n    ) %>% \n    gt::tab_header(title = \"Return Summary\", subtitle = \"Monthly Periodicity\") %>% \n    gt::tab_footnote(locations = cells_column_labels(columns = contains(\"Ratio\")), footnote = \"Calculation does not include the risk-free rate\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"etxrnhgdnf\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#etxrnhgdnf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#etxrnhgdnf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#etxrnhgdnf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#etxrnhgdnf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#etxrnhgdnf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#etxrnhgdnf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#etxrnhgdnf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#etxrnhgdnf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#etxrnhgdnf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#etxrnhgdnf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#etxrnhgdnf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#etxrnhgdnf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#etxrnhgdnf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etxrnhgdnf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#etxrnhgdnf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#etxrnhgdnf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etxrnhgdnf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#etxrnhgdnf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etxrnhgdnf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#etxrnhgdnf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etxrnhgdnf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#etxrnhgdnf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etxrnhgdnf .gt_left {\n  text-align: left;\n}\n\n#etxrnhgdnf .gt_center {\n  text-align: center;\n}\n\n#etxrnhgdnf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#etxrnhgdnf .gt_font_normal {\n  font-weight: normal;\n}\n\n#etxrnhgdnf .gt_font_bold {\n  font-weight: bold;\n}\n\n#etxrnhgdnf .gt_font_italic {\n  font-style: italic;\n}\n\n#etxrnhgdnf .gt_super {\n  font-size: 65%;\n}\n\n#etxrnhgdnf .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#etxrnhgdnf .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#etxrnhgdnf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#etxrnhgdnf .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#etxrnhgdnf .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#etxrnhgdnf .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  <thead class=\"gt_header\">\n    <tr>\n      <th colspan=\"6\" class=\"gt_heading gt_title gt_font_normal\" style>Return Summary</th>\n    </tr>\n    <tr>\n      <th colspan=\"6\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Monthly Periodicity</th>\n    </tr>\n  </thead>\n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Mean </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Standard Deviation </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Downside Standard Deviation </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Sharpe Ratio<sup class=\"gt_footnote_marks\">1</sup></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Sortino Ratio<sup class=\"gt_footnote_marks\">1</sup></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right gt_stub\">Active Portfolio</td>\n<td class=\"gt_row gt_right\">0.74%</td>\n<td class=\"gt_row gt_right\">3.0%</td>\n<td class=\"gt_row gt_right\">2.0%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">25.1%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">36.9%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">60/40 Portfolio</td>\n<td class=\"gt_row gt_right\">0.63%</td>\n<td class=\"gt_row gt_right\">2.7%</td>\n<td class=\"gt_row gt_right\">2.1%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">23.6%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">30.0%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">AGG</td>\n<td class=\"gt_row gt_right\">0.25%</td>\n<td class=\"gt_row gt_right\">1.2%</td>\n<td class=\"gt_row gt_right\">0.8%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">21.2%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">30.4%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">SP500</td>\n<td class=\"gt_row gt_right\">0.85%</td>\n<td class=\"gt_row gt_right\">4.3%</td>\n<td class=\"gt_row gt_right\">3.3%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">19.9%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">26.2%</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"6\"><sup class=\"gt_footnote_marks\">1</sup> Calculation does not include the risk-free rate</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\nThis occurs because our Active Portfolio is able to identify time periods when it is preferable to hold fixed income rather than equities, and vice versa. As a result, our portfolio has an average allocation of 75/25!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_tbl %>% \n    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3 = 0),\n           port_fi_weight = 1 - port_equity_weight) %>%\n    summarize(across(.cols = contains(\"port\"), .fns = ~mean(.x, na.rm = T))) %>% \n    set_names(c(\"Average Equity Allocation\", \"Average Fixed Income Allocation\")) %>% \n    gt() %>% \n    fmt_percent(columns = everything())\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ruhfkopevs\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#ruhfkopevs .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ruhfkopevs .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ruhfkopevs .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ruhfkopevs .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ruhfkopevs .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ruhfkopevs .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ruhfkopevs .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ruhfkopevs .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ruhfkopevs .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ruhfkopevs .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ruhfkopevs .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ruhfkopevs .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ruhfkopevs .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ruhfkopevs .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ruhfkopevs .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ruhfkopevs .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ruhfkopevs .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ruhfkopevs .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ruhfkopevs .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ruhfkopevs .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ruhfkopevs .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ruhfkopevs .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ruhfkopevs .gt_left {\n  text-align: left;\n}\n\n#ruhfkopevs .gt_center {\n  text-align: center;\n}\n\n#ruhfkopevs .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ruhfkopevs .gt_font_normal {\n  font-weight: normal;\n}\n\n#ruhfkopevs .gt_font_bold {\n  font-weight: bold;\n}\n\n#ruhfkopevs .gt_font_italic {\n  font-style: italic;\n}\n\n#ruhfkopevs .gt_super {\n  font-size: 65%;\n}\n\n#ruhfkopevs .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#ruhfkopevs .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#ruhfkopevs .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ruhfkopevs .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#ruhfkopevs .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#ruhfkopevs .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Average Equity Allocation</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Average Fixed Income Allocation</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">74.17%</td>\n<td class=\"gt_row gt_right\">25.83%</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nWe can plot our portfolio's allocation to equities over time:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n    geom_line(\n        data = start_tbl %>% \n                    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3=0),\n                    port_fi_weight = 1 - port_equity_weight),\n        mapping = aes(date, port_equity_weight)\n    ) +\n    geom_rect(\n        data = major_troughs_tbl %>% \n            slice(2),\n        mapping = aes(xmin = start_date, xmax = end_date, ymin = -Inf, ymax = Inf),\n        fill = \"red\",\n        alpha = .3\n    ) +\n    theme_tq() +\n    scale_color_tq() +\n    scale_y_continuous(labels = scales::label_percent()) +\n    labs(x = \"\", y = \"Allocation to Equities\") +\n    theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![The red shaded region indicates the start of the Covid-19 Pandemic](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\nAs we can see, our portfolio underweights equities during times when EPS Revision Breadth is low, and overweights equities when EPS Revision breadth is high. However, we notice that it will therefore underweight equities in 2020, when the Covid-19 pandemic started.\n\nWhile the start of the Covid-19 pandemic was momentous, markets severely overreacted, and many savvy investors capitalized on these overreactions. Unlike in 2001 and 2008, when market expectations plummeted due to the burst of a financial bubble, in 2022 market expectations plummeted due to frenzied speculation. Because of this, it is unlikely that a rational investor would have sold all of his equities; so, lets course correct our portfolio with human judgement.\n\n### Course Correcting w/ Human Judgement\n\nLet's assume that we are savvy investors, and that in March of 2022 we increased our allocation to equities to 75% because we understood that the markets were acting irrationally. If we do this while keeping everything else the same, here is how our active portfolio would have performed:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreturns_and_index_mod <- start_tbl %>% \n    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3 = 0)) %>% \n    mutate(port_equity_weight = ifelse(\n        date %>% between(major_troughs_tbl$start_date[2], major_troughs_tbl$end_date[2]),\n        .75, port_equity_weight)) %>% \n    mutate(port_fi_weight = 1 - port_equity_weight) %>% \n    drop_na() %>% \n    mutate(portfolio_return = (port_equity_weight * SPY) + (port_fi_weight * AGG),\n           portfolio_60_40_return = (.6 * SPY) + (.4 * AGG)) %>% \n    pivot_longer(cols = c(SPY, AGG, contains(\"portfolio\"))) %>% \n    group_by(name) %>% \n    mutate(price_index = cumprod(1+value)) %>%\n    ungroup() %>% \n    mutate(name = case_when(\n        name == \"SPY\" ~ \"SP500\",\n        name == \"portfolio_60_40_return\" ~ \"60/40 Portfolio\",\n        name == \"portfolio_return\" ~ \"Active Portfolio\",\n        name == \"AGG\" ~ \"AGG\"\n    ))\n\nreturns_and_index_mod %>% \n    ggplot(aes(date, price_index, color = name)) +\n    geom_line() +\n    theme_tq() +\n    scale_color_tq() +\n    theme(legend.position = \"top\", text = element_text(size = 16)) +\n    labs(x = \"\", y = \"Wealth Index ($1)\", color = \"\", title = \"Portfolio Comparison\") +\n    scale_y_continuous(labels = scales::dollar_format())\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\nNow, we notice that our active portfolio barely under-performs the market while still mitigating risk:\n\n::: panel-tabset\n#### Return Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonthly_returns_mod <- returns_and_index_mod %>% \n    select(date, name, value) %>% \n    mutate(year = year(date),\n           month = month(date)) %>% \n    group_by(month, year, name) %>% \n    mutate(month_return = cumprod(1+value) - 1) %>% \n    slice_tail(n=1) %>% \n    ungroup() %>% \n    group_by(name)\n\nmonthly_returns_mod %>% \n    summarize(\n        mean_monthly_return = mean(month_return),\n        st_dev_monthly_return = sd(month_return)\n    ) %>% \n    left_join(\n       monthly_returns %>% \n           filter(month_return < 0) %>% \n           group_by(name) %>% \n           summarize(downside_st_dev_monthly_return = sd(month_return))\n    ) %>% \n    mutate(sharpe_ratio = mean_monthly_return / st_dev_monthly_return,\n           sortino_ratio = mean_monthly_return / downside_st_dev_monthly_return) %>% \n    arrange(desc(sharpe_ratio)) %>% \n    set_names(names(.) %>% str_remove_all(\"monthly_return\") %>% str_replace_all(\"st_dev\", \"standard deviation\") %>%  str_replace_all(\"_\", \" \") %>% str_to_title()) %>% \n    gt(rowname_col = \"Name\") %>% \n    fmt_percent(columns = 2, decimals = 2) %>% \n    fmt_percent(columns = 3:last_col(), decimals = 1) %>% \n    tab_style(\n        style = cell_text(weight = \"bold\"),\n        locations = cells_body(columns = contains(\"Ratio\"))\n    ) %>% \n    gt::tab_header(title = \"Return Summary\", subtitle = \"Monthly Periodicity\") %>% \n    gt::tab_footnote(locations = cells_column_labels(columns = contains(\"Ratio\")), footnote = \"Calculation does not include the risk-free rate\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"nviihqccls\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#nviihqccls .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#nviihqccls .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nviihqccls .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#nviihqccls .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#nviihqccls .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nviihqccls .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nviihqccls .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#nviihqccls .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#nviihqccls .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#nviihqccls .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#nviihqccls .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#nviihqccls .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#nviihqccls .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#nviihqccls .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#nviihqccls .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#nviihqccls .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#nviihqccls .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nviihqccls .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#nviihqccls .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#nviihqccls .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nviihqccls .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#nviihqccls .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#nviihqccls .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nviihqccls .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nviihqccls .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#nviihqccls .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#nviihqccls .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nviihqccls .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nviihqccls .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nviihqccls .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nviihqccls .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nviihqccls .gt_left {\n  text-align: left;\n}\n\n#nviihqccls .gt_center {\n  text-align: center;\n}\n\n#nviihqccls .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#nviihqccls .gt_font_normal {\n  font-weight: normal;\n}\n\n#nviihqccls .gt_font_bold {\n  font-weight: bold;\n}\n\n#nviihqccls .gt_font_italic {\n  font-style: italic;\n}\n\n#nviihqccls .gt_super {\n  font-size: 65%;\n}\n\n#nviihqccls .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#nviihqccls .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#nviihqccls .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#nviihqccls .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#nviihqccls .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#nviihqccls .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  <thead class=\"gt_header\">\n    <tr>\n      <th colspan=\"6\" class=\"gt_heading gt_title gt_font_normal\" style>Return Summary</th>\n    </tr>\n    <tr>\n      <th colspan=\"6\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Monthly Periodicity</th>\n    </tr>\n  </thead>\n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Mean </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Standard Deviation </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Downside Standard Deviation </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Sharpe Ratio<sup class=\"gt_footnote_marks\">1</sup></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Sortino Ratio<sup class=\"gt_footnote_marks\">1</sup></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right gt_stub\">Active Portfolio</td>\n<td class=\"gt_row gt_right\">0.77%</td>\n<td class=\"gt_row gt_right\">3.1%</td>\n<td class=\"gt_row gt_right\">2.0%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">25.0%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">38.3%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">60/40 Portfolio</td>\n<td class=\"gt_row gt_right\">0.63%</td>\n<td class=\"gt_row gt_right\">2.7%</td>\n<td class=\"gt_row gt_right\">2.1%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">23.6%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">30.0%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">AGG</td>\n<td class=\"gt_row gt_right\">0.25%</td>\n<td class=\"gt_row gt_right\">1.2%</td>\n<td class=\"gt_row gt_right\">0.8%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">21.2%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">30.4%</td></tr>\n    <tr><td class=\"gt_row gt_right gt_stub\">SP500</td>\n<td class=\"gt_row gt_right\">0.85%</td>\n<td class=\"gt_row gt_right\">4.3%</td>\n<td class=\"gt_row gt_right\">3.3%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">19.9%</td>\n<td class=\"gt_row gt_right\" style=\"font-weight: bold;\">26.2%</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"6\"><sup class=\"gt_footnote_marks\">1</sup> Calculation does not include the risk-free rate</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\n#### Average Allocation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_tbl %>% \n    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3 = 0)) %>% \n    mutate(port_equity_weight = ifelse(\n        date %>% between(major_troughs_tbl$start_date[2], major_troughs_tbl$end_date[2]),\n        .75, port_equity_weight)) %>% \n    mutate(port_fi_weight = 1 - port_equity_weight) %>% \n    summarize(across(.cols = contains(\"port\"), .fns = ~mean(.x, na.rm = T))) %>% \n    set_names(c(\"Average Equity Allocation\", \"Average Fixed Income Allocation\")) %>% \n    gt() %>% \n    fmt_percent(columns = everything())\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"zodtiqezgj\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#zodtiqezgj .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zodtiqezgj .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zodtiqezgj .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zodtiqezgj .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zodtiqezgj .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zodtiqezgj .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zodtiqezgj .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zodtiqezgj .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zodtiqezgj .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zodtiqezgj .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zodtiqezgj .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zodtiqezgj .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zodtiqezgj .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zodtiqezgj .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zodtiqezgj .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zodtiqezgj .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zodtiqezgj .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zodtiqezgj .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zodtiqezgj .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zodtiqezgj .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zodtiqezgj .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zodtiqezgj .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zodtiqezgj .gt_left {\n  text-align: left;\n}\n\n#zodtiqezgj .gt_center {\n  text-align: center;\n}\n\n#zodtiqezgj .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zodtiqezgj .gt_font_normal {\n  font-weight: normal;\n}\n\n#zodtiqezgj .gt_font_bold {\n  font-weight: bold;\n}\n\n#zodtiqezgj .gt_font_italic {\n  font-style: italic;\n}\n\n#zodtiqezgj .gt_super {\n  font-size: 65%;\n}\n\n#zodtiqezgj .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#zodtiqezgj .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#zodtiqezgj .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zodtiqezgj .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#zodtiqezgj .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#zodtiqezgj .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Average Equity Allocation</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Average Fixed Income Allocation</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">75.44%</td>\n<td class=\"gt_row gt_right\">24.56%</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n#### Equity Allocation over Time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n    geom_line(\n        data = start_tbl %>% \n    mutate(port_equity_weight = sigmoid(eps_revision_breadth, c1 = 20, c2 = -.075, c3 = 0)) %>% \n    mutate(port_equity_weight = ifelse(\n        date %>% between(major_troughs_tbl$start_date[2], major_troughs_tbl$end_date[2]),\n        .75, port_equity_weight)),\n        mapping = aes(date, port_equity_weight)\n    ) +\n    theme_tq() +\n    scale_color_tq() +\n    scale_y_continuous(labels = scales::label_percent()) +\n    labs(x = \"\", y = \"Allocation to Equities\") +\n    theme(text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n:::\n\n### Modifying C1 & C2\n\nDuring the construction of our portfolio, we arbitrarily used *C1 = 20* and *C2 = -.075* as inputs for our allocation function because they replicated our rough, 'prototype' weighting scheme. In addition, these inputs seemed sensible for the average investor as they yielded, on average, a 75/25 weighting scheme. However, we can adjust these parameters depending on the risk appetite of the investor.\n\nThe following demonstrates graphically what occurs as you change C1:\n\n![](sigmoid.png)\n\nAs we can see, C1 represents our sensitivity to changes in EPS Revision Breadth, C2 represents the EPS Revision Breadth value that corresponds to an equity allocation of 50% (if and only if C3 = 0), and C3 represents a minimum equity allocation. Therefore, we can elect to modify our weighting scheme for different investment styles. The following could represent a sample weighting scheme for an investor that would like to be less sensitive to changes in EPS Revision Breadth with a minimum equity allocation of 40%:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n    eps_rb = seq(-1, 1 ,by=.01),\n    `Equity Allocation` = sigmoid(eps_rb, c1 = 10, c2 = -.075, c3 = .4),\n    `Fixed Income Allocation` = 1-`Equity Allocation`\n) %>% \n    pivot_longer(contains(\"Allocation\")) %>% \n    ggplot(aes(eps_rb, value, color = name)) +\n    geom_line() +\n    scale_x_continuous(labels = scales::percent_format()) +\n    scale_y_continuous(labels = scales::percent_format()) +\n    theme_tq() +\n    scale_color_tq() +\n    labs(\n        x = \"EPS Revision Breadth\", y = \"Portfolio Weight\", title = \"Allocation Function\", subtitle = \"C1 = 10, C2 = -7.5%%, C3 = 40%\", color = \"\"\n    ) +\n    theme(legend.position = \"top\", text = element_text(size = 16))\n```\n\n::: {.cell-output-display}\n![](eps_revision_breadth_analysis_files/figure-html/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\n## Key Takeaways\n\nAs we can surmise from the analysis above, EPS Revision Breadth is a useful financial metric that reflects general market sentiment, which can help an investor position their portfolio accordingly.\n\n## Additional Areas of Exploration\n\nWhile I will not do so here, the above can be extended and replicated for each sector within the SP500 - allowing for an active portfolio that dynamically overweights and underweights specific sectors over time according to each sectors EPS Revision Breadth. It would also be wise to include several other variables, attempt to build a major tough vs. minor trough classifier, and incorporate other asset classes in the portfolio for diversification benefits.\n\n## Final Remarks\n\n*The above is intended as an exploration of historical data, and all statements and opinions are expressly my own; neither should be construed as investment advice.*\n",
    "supporting": [
      "eps_revision_breadth_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/d3-3.3.8/d3.min.js\"></script>\n<script src=\"../../site_libs/dagre-0.4.0/dagre-d3.min.js\"></script>\n<link href=\"../../site_libs/mermaid-0.3.0/dist/mermaid.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js\"></script>\n<link href=\"../../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/chromatography-0.1/chromatography.js\"></script>\n<script src=\"../../site_libs/DiagrammeR-binding-1.0.9/DiagrammeR.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}